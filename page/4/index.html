<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Jimmy | iOS | develop | 移动">
<meta property="og:type" content="website">
<meta property="og:title" content="Jimmy&#39;Zone">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Jimmy&#39;Zone">
<meta property="og:description" content="Jimmy | iOS | develop | 移动">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jimmy&#39;Zone">
<meta name="twitter:description" content="Jimmy | iOS | develop | 移动">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>Jimmy'Zone</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jimmy'Zone</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">态度决定一切，细节决定成败</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/06/2017-02-06-快速搭建个人博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/06/2017-02-06-快速搭建个人博客/" itemprop="url">快速搭建个人博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-06T00:00:00+08:00">
                2017-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>正所谓前人栽树，后人乘凉。</p>
<p>感谢<a href="https://github.com/huxpro" target="_blank" rel="external">Huxpro</a>提供的博客模板</p>
<p><a href="http://qiubaiying.top" target="_blank" rel="external">我的的博客</a></p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>从 Jekyll 到 GitHub Pages 中间踩了许多坑，终于把我的个人博客<a href="http://qiubaiying.top" target="_blank" rel="external">BY Blog</a>搭建出来了。。。</p>
<p>本教程针对的是不懂技术又想搭建个人博客的小白，操作简单暴力且快速。当然懂技术那就更好了。</p>
<p>废话不多说了，开始进入正文。</p>
<h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><h3 id="从注册一个Github账号开始"><a href="#从注册一个Github账号开始" class="headerlink" title="从注册一个Github账号开始"></a>从注册一个Github账号开始</h3><p>我采用的搭建博客的方式是使用 <a href="https://pages.github.com/" target="_blank" rel="external">GitHub Pages</a> + <a href="http://jekyll.com.cn/" target="_blank" rel="external">jekyll</a> 的方式。</p>
<p>要使用 GitHub Pages，首先你要注册一个 <a href="https://github.com/" target="_blank" rel="external">GitHub</a> 账号，GitHub 是全球最大的同性交友网站(吐槽下程序员~)，你值得拥有。</p>
<p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fch0a9kz7aj31kw0z7npd.jpg" alt=""></p>
<h3 id="拉取我的博客模板"><a href="#拉取我的博客模板" class="headerlink" title="拉取我的博客模板"></a>拉取我的博客模板</h3><p>注册完成后搜索 <code>qiubaiying.github.io</code> 进入<a href="https://github.com/qiubaiying/qiubaiying.github.io" target="_blank" rel="external">我的仓库</a></p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcgqjugzkpj30yy0p1mzc.jpg" alt=""></p>
<p>点击右上角的 <strong>Fork</strong> 将我的仓库拉倒你的账号下</p>
<p>稍等一下，点击刷新，你会看到<strong>Fork</strong>了成功的页面</p>
<p><img src="https://ww3.sinaimg.cn/large/006tKfTcgy1fch1i297pjj31kw0z7thk.jpg" alt=""></p>
<h3 id="修改仓库名"><a href="#修改仓库名" class="headerlink" title="修改仓库名"></a>修改仓库名</h3><p>点击<strong>settings</strong>进入设置</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcgqms2auij30yy0p1tau.jpg" alt=""></p>
<p></p><p id="Rename"></p><br>修改仓库名为 <code>你的Github账号名.github.io</code>，然后 Rename<p></p>
<p><img src="https://ww4.sinaimg.cn/large/006tNbRwgy1fcgqfwtk1rj30yy0p1wg6.jpg" alt=""></p>
<p>这时你在在浏览器中输入 <code>你的Github账号名.github.io</code> 例如:<code>baiyingqiu.github.io</code></p>
<p>你将会看到如下界面</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcgquoqasqj30we0n8q4n.jpg" alt=""></p>
<p>说明已经成功一半了😀。。。当然，还需要修改博客的配置才能变成你的博客。</p>
<p>若是出现</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcgqz6dyxmj30we0n83yy.jpg" alt=""></p>
<p>则需要 <a href="#Rename">检查一下你的仓库名是否正确</a></p>
<h3 id="整个网站结构"><a href="#整个网站结构" class="headerlink" title="整个网站结构"></a>整个网站结构</h3><p>修改Blog前我们来看看Jekyll 网站的基础结构，当然我们的网站比这个复杂。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">├── _config.yml</div><div class="line">├── _drafts</div><div class="line">|   ├── begin-with-the-crazy-ideas.textile</div><div class="line">|   └── on-simplicity-in-technology.markdown</div><div class="line">├── _includes</div><div class="line">|   ├── footer.html</div><div class="line">|   └── header.html</div><div class="line">├── _layouts</div><div class="line">|   ├── default.html</div><div class="line">|   └── post.html</div><div class="line">├── _posts</div><div class="line">|   ├── 2007-10-29-why-every-programmer-should-play-nethack.textile</div><div class="line">|   └── 2009-04-26-barcamp-boston-4-roundup.textile</div><div class="line">├── _data</div><div class="line">|   └── members.yml</div><div class="line">├── _site</div><div class="line">├── img</div><div class="line">└── index.html</div></pre></td></tr></table></figure>
<p>很复杂看不懂是不是，不要紧，你只要记住其中几个OK了</p>
<ul>
<li><code>_config.yml</code> 全局配置文件</li>
<li><code>_posts</code>    放置博客文章的文件夹</li>
<li><code>img</code>    存放图片的文件夹</li>
</ul>
<p>其他的想继续深究可以<a href="http://jekyll.com.cn/docs/structure/" target="_blank" rel="external">看这里</a></p>
<h3 id="修改博客配置"><a href="#修改博客配置" class="headerlink" title="修改博客配置"></a>修改博客配置</h3><p>来到你的仓库，找到<code>_config.yml</code>文件,这是网站的全局配置文件。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNbRwgy1fcgrcxz8nqj30v90ulwh7.jpg" alt=""></p>
<p>点击修改</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcgrjzc232j30uz0nijt6.jpg" alt=""></p>
<p>然后编辑<code>_config.yml</code>的内容</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcgrnp4ihqj30uy0okwg9.jpg" alt=""></p>
<p>接下来我们来详细说说以下配置文件的内容：</p>
<h4 id="基础设置"><a href="#基础设置" class="headerlink" title="基础设置"></a>基础设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># Site settings</div><div class="line">title: You Blog    				  	#你博客的标题</div><div class="line">SEOTitle: 你的博客 | You Blog    	 #显示在浏览器上搜索的时候显示的标题</div><div class="line">header-img: img/post-bg-rwd.jpg  	#显示在首页的背景图片</div><div class="line">email: You@gmail.com	</div><div class="line">description: &quot;You Blog&quot;  			 #网站介绍</div><div class="line">keyword: &quot;BY, BY Blog, 柏荧的博客, qiubaiying, 邱柏荧, iOS, Apple, iPhone&quot; #关键词</div><div class="line">url: &quot;https://qiubaiying.github.io&quot;          # 这个就是填写你的博客地址</div><div class="line">baseurl: &quot;&quot;      # 这个我们不用填写</div></pre></td></tr></table></figure>
<h4 id="侧边栏"><a href="#侧边栏" class="headerlink" title="侧边栏"></a>侧边栏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Sidebar settings</div><div class="line">sidebar: true                           # 是否开启侧边栏.</div><div class="line">sidebar-about-description: &quot;说点装逼的话。。。&quot;</div><div class="line">sidebar-avatar: img/avatar-by.JPG      # 你的个人头像 这里你可以改成我在img文件夹中的两张备用照片 img/avatar-m 或 avatar-g</div></pre></td></tr></table></figure>
<h4 id="社交账号"><a href="#社交账号" class="headerlink" title="社交账号"></a>社交账号</h4><p>展示你的其他社交平台</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcgsm4plpdj307i03nt8i.jpg" alt=""></p>
<p>在下面你的社交账号的用户名就可以了，若没有可不用填</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># SNS settings</div><div class="line">RSS: false</div><div class="line">weibo_username:     username</div><div class="line">zhihu_username:     username</div><div class="line">github_username:    username</div><div class="line">facebook_username:  username</div><div class="line">jianshu_username:	jianshu_id</div></pre></td></tr></table></figure>
<p>新加入了<strong>简书</strong>，<code>jianshu_id</code> 在你打开你的简书主页后的地址如：<code>http://www.jianshu.com/u/e71990ada2fd</code>中，后面这一串数字：<code>e71990ada2fd</code></p>
<h4 id="评论系统"><a href="#评论系统" class="headerlink" title="评论系统"></a>评论系统</h4><p><del>集成了多说社会化评论，到多说注册账号，然后将<code>duoshuo_username</code>换成你的账号即可。</del></p>
<blockquote>
<p>多说即将关闭：说将于2017年6月1日正式关停服务，<a href="http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241" target="_blank" rel="external">详见官网</a></p>
</blockquote>
<p>我们博客的评论系统切换到 <a href="https://disqus.com/" target="_blank" rel="external">Disqus</a>,在官网注册帐号之后，在下面的填写你多说的用户名的就可以使用。</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1feudbz8o8sj30mu0g1abt.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Disqus settings（https://disqus.com/）</div><div class="line">disqus_username: qiubaiying</div></pre></td></tr></table></figure>
<h4 id="网站统计"><a href="#网站统计" class="headerlink" title="网站统计"></a>网站统计</h4><p>集成了 <a href="http://tongji.baidu.com/web/welcome/login" target="_blank" rel="external">Baidu Analytics</a> 和 <a href="http://www.google.cn/analytics/" target="_blank" rel="external">Google Analytics</a>，到各个网站注册拿到track_id替换下面的就可以了</p>
<p>这是我的 Google Analytics</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79gy1fcgtqc5wf0j310i0nbt9j.jpg" alt=""></p>
<p><strong>不要使用我的track_id</strong>😂。。。</p>
<p>若不想启用统计，直接删除或注释掉就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># Analytics settings</div><div class="line"># Baidu Analytics</div><div class="line">ba_track_id: 83e259f69b37d02a4633a2b7d960139c</div><div class="line"></div><div class="line"># Google Analytics</div><div class="line">ga_track_id: &apos;UA-90855596-1&apos;            # Format: UA-xxxxxx-xx</div><div class="line">ga_domain: auto</div></pre></td></tr></table></figure>
<h4 id="好友"><a href="#好友" class="headerlink" title="好友"></a>好友</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">friends: [</div><div class="line">    &#123;</div><div class="line">        title: &quot;简书·BY&quot;,</div><div class="line">        href: &quot;http://www.jianshu.com/u/e71990ada2fd&quot;</div><div class="line">    &#125;,&#123;</div><div class="line">        title: &quot;Apple&quot;,</div><div class="line">        href: &quot;https://apple.com&quot;</div><div class="line">    &#125;,&#123;</div><div class="line">        title: &quot;Apple Developer&quot;,</div><div class="line">        href: &quot;https://developer.apple.com/&quot;</div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<h4 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h4><p>讲网页拉倒底部，点击 <code>Commit changes</code> 提交保存</p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fch1mpktilj31kw0z7n34.jpg" alt=""></p>
<p>再次进入你的主页，</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79gy1fcgtqheu38j30uy0kc3zs.jpg" alt=""></p>
<p>恭喜你，你的个人博客搭建完成了😀。</p>
<h1 id="写文章"><a href="#写文章" class="headerlink" title="写文章"></a>写文章</h1><p>利用 Github网站 ，我们可以不用学习<a href="https://git-scm.com/" target="_blank" rel="external">git</a>，就可以轻松管理自己的博客</p>
<p>对于轻车熟路的程序猿来说，使用git管理会更加方便。。。</p>
<h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p>文章统一放在网站根目录下的 <code>_posts</code> 的文件夹中。</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79gy1fchoc1tz03j30vi0k978h.jpg" alt=""></p>
<p>创建一个文件</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79gy1fchoduzebyj30vn0eg0v7.jpg" alt=""></p>
<p>在下面写文章，和标题，还能实时预览，最后提交保存就能看到自己的新文章了。</p>
<p><img src="https://ww2.sinaimg.cn/large/006y8lVagy1fcgweml8hjj30vd0m775r.jpg" alt=""></p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><p>每一篇文章文件命名采用的是<code>2017-02-04-Hello-2017.md</code>时间+标题的形式，空格用<code>-</code>替换连接。</p>
<p>文件的格式是 <code>.md</code> 的 <a href="http://sspai.com/25137/" target="_blank" rel="external"><strong>MarkDown</strong></a> 文件。</p>
<p>我们的博客文章格式采用是 <strong>MarkDown</strong>+ <strong>YAML</strong> 的方式。</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html?f=tt" target="_blank" rel="external"><strong>YAML</strong></a> 就是我们配置 <code>_config</code>文件用的语言。</p>
<p><a href="http://sspai.com/25137/" target="_blank" rel="external"><strong>MarkDown</strong></a> 是一种轻量级的「标记语言」，很简单。<a href="http://sspai.com/25137" target="_blank" rel="external">花半个小时看一下</a>就能熟练使用了</p>
<p>大概就是这么一个结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">layout:     post   				    # 使用的布局（不需要改）</div><div class="line">title:      My First Post 				# 标题 </div><div class="line">subtitle:   Hello World, Hello Blog #副标题</div><div class="line">date:       2017-02-06 				# 时间</div><div class="line">author:     BY 						# 作者</div><div class="line">header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片</div><div class="line">catalog: true 						# 是否归档</div><div class="line">tags:								#标签</div><div class="line">    - 生活</div><div class="line">---</div><div class="line"></div><div class="line">## Hey</div><div class="line">&gt;这是我的第一篇博客。</div><div class="line"></div><div class="line">进入你的博客主页，新的文章将会出现在你的主页上.</div></pre></td></tr></table></figure>
<p>按格式创建文章后，提交保存。进入你的博客主页，新的文章将会出现在你的主页上.</p>
<p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fch26elve4j31kw13qhdt.jpg" alt=""></p>
<h4 id="首页标签"><a href="#首页标签" class="headerlink" title="首页标签"></a>首页标签</h4><p>在首页可以看到这些特色标签，当你的文章出现相同标签（默认相同的<strong>标签数量大于1</strong>），才会自动生成。</p>
<p>所以当你只放一篇文章的时候是不会出现标签的。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fh7uy90ayzj30gd09udh0.jpg" alt=""></p>
<p>建站的初期，博客比较少，若你想直接在首页生成比较多的标签。你可以在 <code>_congfig.yml</code>中找到这段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Featured Tags</div><div class="line">featured-tags: true                     # 是否使用首页标签</div><div class="line">featured-condition-size: 1              # 相同标签数量大于这个数，才会出现在首页</div></pre></td></tr></table></figure>
<p>将其修改为<code>featured-condition-size: 0</code>, 这样只有一个标签时也会出现在首页了。</p>
<p>相反，当你博客比较多，标签也很多时，这时你就需要改回 <code>1</code> 甚至是 <code>2</code> 了。</p>
<p>到这里，恭喜你！</p>
<p>你已经成功搭建了自己的个人博客以及学会在博客上撰写文字的技能了（是不是有点小兴奋🙈）。</p>
<h1 id="自定义域名"><a href="#自定义域名" class="headerlink" title="自定义域名"></a>自定义域名</h1><p>搭建好博客之后 你可能不想直接使用 <a href="http://baiyingqiu.github.io" target="_blank" rel="external">baiyingqiu.github.io</a> 这么长的博客域名吧, 想换成想 <a href="http://qiubaiying.top" target="_blank" rel="external">qiubaiying.top</a> 这样简短的域名。那我们开始吧！</p>
<h4 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h4><p>首先，你必须购买一个自己的域名。</p>
<p>我是在<a href="https://wanwang.aliyun.com/domain/?spm=5176.8006371.1007.dnetcndomain.q1ys4x" target="_blank" rel="external">阿里云</a>购买的域名</p>
<p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fci89zv06yj31kw11p1kx.jpg" alt=""></p>
<p>用<strong>阿里云</strong> app也可以注册域名，域名的价格根据后缀的不同和域名的长度而分，比如我这个 <code>qiubaiying.top</code> 的域名第一年才只要4元~</p>
<p>域名尽量选择短一点比较好记住，注意，不能选择中文域名，比如 <code>张三.top</code> ,GitHub Pages <strong>无法处理中文域名</strong>，会导致你的域名在你的主页上使用。</p>
<p>注册的步骤就不在介绍了</p>
<h4 id="解析域名"><a href="#解析域名" class="headerlink" title="解析域名"></a>解析域名</h4><p>注册好域名后，需要将域名解析到你的博客上</p>
<p>管理控制台 → 域名与网站（万网） → 域名</p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcgy1fci8phk5z9j30nk0q0goy.jpg" alt=""></p>
<p>选择你注册好的域名，点击解析</p>
<p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fci8sg27bfj31kw0s0qdt.jpg" alt=""></p>
<p>添加解析</p>
<p>分别添加两个<code>A</code> 记录类型,</p>
<p>一个主机记录为 <code>www</code>,代表可以解析 <code>www.qiubaiying.top</code>的域名</p>
<p>另一个为 <code>@</code>, 代表 <code>qiubaiying.top</code></p>
<p>记录值就是我们博客的IP地址，是 GitHub Pagas 在美国的服务器的地址 <code>151.101.100.133</code></p>
<p><img src="https://ww3.sinaimg.cn/large/006tKfTcgy1fci8x9412oj31kw0o4n5o.jpg" alt=""></p>
<p>可以通过 <a href="http://ip.chinaz.com/" target="_blank" rel="external">这个网站</a>  或者直接在终端输入<code>ping 你的地址</code>，查看博客的IP</p>
<pre><code>ping qiubaiying.github.io
</code></pre><p>细心地你会发现所有人的博客都解析到 <code>151.101.100.133</code> 这个IP。</p>
<p>然后 GitHub Pages 再通过 CNAME记录 跳转到你的主页上。</p>
<h4 id="修改CNAME"><a href="#修改CNAME" class="headerlink" title="修改CNAME"></a>修改CNAME</h4><p>最后一步，只需要修改 我们github仓库下的 <strong>CNAME</strong> 文件。</p>
<p>选择 <strong>CNAME</strong> 文件</p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fci9q9ne6qj31kw0uuajm.jpg" alt=""></p>
<p>使用的注册的域名进行替换,然后提交保存</p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fci9rzk0naj316s0n841s.jpg" alt=""></p>
<p>这时，输入你自己的域名，就可以解析到你的主页了。</p>
<p>大功告成！</p>
<h1 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h1><p>若你对博客模板进行修改，你就要看看 Jekyll 的<a href="http://jekyll.com.cn" target="_blank" rel="external">开发文档</a>,是中文文档哦，对英语不好的朋友简直是福利啊（比如说我😀）。</p>
<p>还要学习 <strong>Git</strong> 和 <strong>GitHub</strong> 的工作机制了及使用。</p>
<p>你可以先看看这个<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/" target="_blank" rel="external">git教程</a>，对git有个初步的了解后，那么相信你就能将自己图片传到GitHub仓库上，或者可以说掌握了 <strong>使用git管理自己的GitHub仓库</strong> 的技能呢。</p>
<p>对于轻车熟路的程序猿来说，这篇教程就算就结束了，因为下面的内容对于你们来说 so eazy~</p>
<p>但相信很多小白都一脸懵逼，那我们继续👇。</p>
<h1 id="利用GithHub-Desktop管理GitHub仓库"><a href="#利用GithHub-Desktop管理GitHub仓库" class="headerlink" title="利用GithHub Desktop管理GitHub仓库"></a>利用GithHub Desktop管理GitHub仓库</h1><p><a href="https://desktop.github.com/" target="_blank" rel="external">GithHub Desktop</a> 是 <strong>GithHub</strong> 推出的一款管理GitHub仓库的桌面软件，换句话说就是将你在<strong>Github</strong>上的文件同步到本地电脑上，并将修改后的文件同步到<strong>Github</strong>远程仓库。</p>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>点击图片进入下载页面，选择对应的平台进行下载</p>
<p><a href="https://desktop.github.com/" target="_blank" rel="external"><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcs4th7y21j30zb0nun2l.jpg" alt=""></a></p>
<p>下面以<strong>Mac</strong>平台为例：</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>将下载好的文件解压，将这只小猫拖到应用程序文件夹中</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs4zqqqcnj30kn0evjvh.jpg" alt=""></p>
<p>就可以在<strong>Launchpad</strong>找到这只小猫咪~</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs5100bv8j30gs0f4jya.jpg" alt=""></p>
<h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p>点开应用,会弹出<strong>登录</strong>框，</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNbRwgy1fcs5j8w5r3j30cz0edwgz.jpg" alt=""></p>
<p>输入你的<strong>GitHub</strong>账号和密码进行登录</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcs5jp1buoj30ic0f9abf.jpg" alt=""></p>
<p>登录后关闭窗口</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcs5kam654j30ic0ca0u6.jpg" alt=""></p>
<p>然后返回引导窗，一直按 <strong>Continue</strong> 继续</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcs5m19o9oj30g40hl0wb.jpg" alt=""></p>
<p><strong>Continue</strong></p>
<p><img src="https://ww4.sinaimg.cn/large/006tNbRwgy1fcs5mcteavj30ic0d1gn4.jpg" alt=""></p>
<p>还是<strong>Continue</strong>~<br><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs5msn4jrj30hp0d5jt1.jpg" alt=""></p>
<p>进入主界面，先 <strong>右键Remve</strong> 删除这个用户指导，贼烦~</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs5p6ur5qj30rp0i640z.jpg" alt=""></p>
<h4 id="克隆仓库"><a href="#克隆仓库" class="headerlink" title="克隆仓库"></a>克隆仓库</h4><p>选择你的仓库克隆到本地</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1fcs5px118bj30rq0iatai.jpg" alt=""></p>
<p><img src="https://ww1.sinaimg.cn/large/006tNbRwgy1fcs5s4bs1aj30cq05o0t6.jpg" alt=""></p>
<h4 id="管理仓库"><a href="#管理仓库" class="headerlink" title="管理仓库"></a>管理仓库</h4><p>现在文件夹中打开</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs5rqdaxpj30rn0i7n2x.jpg" alt=""></p>
<p>打开后你会的发现文件结构和你在Github上的一模一样~</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNbRwgy1fcs5sksz92j30lz0irdjs.jpg" alt=""></p>
<p>你最先关心的可能是你的头像~在<strong>img</strong>文件夹中把替换我的头像就好了。</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNbRwgy1fcs5ss0a54j30lz0irwiv.jpg" alt=""></p>
<p>不仅是图片，所有在Github上的的操作都可以进行。</p>
<h4 id="保存修改"><a href="#保存修改" class="headerlink" title="保存修改"></a>保存修改</h4><p>当你对仓库文件夹的文件下进行修改、添加或删除时，都可以在 <strong>GitHub Desktop</strong> 中看到</p>
<p>例如我在 <code>img</code> 中添加了一张图片 <code>avatar-demo.png</code> 添加了一张图片</p>
<p>就可以在看到<strong>GitHub Desktop</strong>显示了我的修改</p>
<p>保存修改只要按 <strong>Commit to master</strong>，然后可以写上你的修改说明</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs8t8fp7nj30uw0lhwgz.jpg" alt=""></p>
<h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><p>将修改同步到 <strong>GitHub</strong> 远程仓库上只需要一步：点击右上角的<strong>同步按钮</strong></p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwgy1fcs8w7vxdoj30uw0lh76d.jpg" alt=""></p>
<h4 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h4><p>打开你的GitHub上的仓库，你就可以看到已经和本地同步了</p>
<p>可以看到你提交的详情： <code>add img</code> </p>
<p><img src="https://ww1.sinaimg.cn/large/006tNbRwgy1fcs8y4ysmhj31050rotea.jpg" alt=""></p>
<p>这样，你已经能轻松管理自己的博客了。</p>
<p>想上传头像，背景，或者是删掉你不要的图片（我的头像😏）已经是 so eazy了吧~</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>你在 <strong>GitHub</strong> 网站上进行 <strong>Commit</strong> 操作后，需要在<strong>GitHub Desktop</strong>上按一下 <strong>同步按键</strong> 才能同步网站上的修改到你的本地。</p>
<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><p>最近有很多人给我提问题，我这边总结一下</p>
<h4 id="配置文件修改后没有效果"><a href="#配置文件修改后没有效果" class="headerlink" title="配置文件修改后没有效果"></a>配置文件修改后没有效果</h4><p>刷新几遍浏览器就好了~</p>
<p>不行的话，先清除浏览器缓存再试试。</p>
<h4 id="404错误"><a href="#404错误" class="headerlink" title="404错误"></a>404错误</h4><ol>
<li>检查你的仓库名是否有按照要求填写</li>
<li>确定 <strong>Fork</strong> 的是不是我的仓库~</li>
</ol>
<h4 id="修改CNAME文件，域名还是不变"><a href="#修改CNAME文件，域名还是不变" class="headerlink" title="修改CNAME文件，域名还是不变"></a>修改CNAME文件，域名还是不变</h4><p>清除浏览器缓存就OK~</p>
<h4 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h4><p>直接在评论中提出来或私信我，我会一一替大家解决的😀</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>最近有人往我的远程仓库不停的 <strong>push</strong>，一天连收几十封邮件！例如像这样的</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNbRwgy1feueecznhjj30k50lpq6u.jpg" alt=""></p>
<p>这打扰了我的工作！</p>
<p>所以，<strong>请不要往我的仓库上推送分支</strong>！</p>
<p>我发现一个问题是，很多人每次修改博客的内容都commit一次到远程，然后再查看修改结果，这样效率非常低！</p>
<h3 id="来，上车！"><a href="#来，上车！" class="headerlink" title="来，上车！"></a>来，上车！</h3><h2 id="在本地调试博客"><a href="#在本地调试博客" class="headerlink" title="在本地调试博客"></a>在本地调试博客</h2><p>有心的同学在 <a href="http://jekyllcn.com/" target="_blank" rel="external">jekyll官网</a> 就会发现 <code>jekyll</code> 的 提供的实例代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">~ $ gem install jekyll bundler</div><div class="line">~ $ jekyll new my-awesome-site</div><div class="line">~ $ cd my-awesome-site</div><div class="line">~/my-awesome-site $ bundle install</div><div class="line">~/my-awesome-site $ bundle exec jekyll serve</div><div class="line"># =&gt; 打开浏览器 http://localhost:4000</div></pre></td></tr></table></figure>
<p>这段命令创建了一个默认的 <code>jekll</code> 网站，然后在本机的 4000 窗口展示。聪明的你应该发现怎么做了吧~</p>
<p>安装 <code>jekyll</code>和 <code>jekyll bundler</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ gem install jekyll</div><div class="line">$ gem install jekyll bundler</div></pre></td></tr></table></figure>
<p>进入你的 <strong>Blog 所在目录</strong>，然后创建本地服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jekyll s</div></pre></td></tr></table></figure>
<p>然后会显示 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> Auto-regeneration: enabled for &apos;/Users/baiying/Blog&apos;</div><div class="line">Configuration file: /Users/baiying/Blog/_config.yml</div><div class="line">    Server address: http://127.0.0.1:4000/</div><div class="line">  Server running... press ctrl-c to stop.</div></pre></td></tr></table></figure>
<p>你就可以在 <a href="http://127.0.0.1:4000/" target="_blank" rel="external">http://127.0.0.1:4000/</a> 看到你的博客，你对本地博客的修改都会在这个地址进行显示，这大大提高了对博客的配置效率。</p>
<p>使用<code>ctrl+c</code>就可以停止 <strong>serve</strong></p>
<h1 id="Star"><a href="#Star" class="headerlink" title="Star"></a>Star</h1><p>若本教程顺利帮你搭建了自己的个人博客，请不要 <strong>害羞</strong>，给我的 <a href="https://github.com/qiubaiying/qiubaiying.github.io" target="_blank" rel="external">github仓库</a> 点个 <strong>star</strong> 吧！</p>
<p>因为最近发现 Fork 将近破百，加上直接 Clone 仓库的，保守估计已经帮助上百人成功的搭建了自己的博客，可是 Star 却仅仅只有 <strong>12</strong>！可能还是做的不够好吧！</p>
<h3 id="别无他求，点个-Star-吧！"><a href="#别无他求，点个-Star-吧！" class="headerlink" title="别无他求，点个 Star 吧！"></a><strong>别无他求，点个 <a href="https://github.com/qiubaiying/qiubaiying.github.io" target="_blank" rel="external">Star</a> 吧</strong>！</h3><p><img src="https://ww2.sinaimg.cn/large/006tNbRwgy1feudm8xrmgj30vu0idn08.jpg" alt=""></p>
<p><strong>心满意足！</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/06/2017-2-9-Mac快速调出终端/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/06/2017-2-9-Mac快速调出终端/" itemprop="url">Mac 快速调出终端</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-06T00:00:00+08:00">
                2017-02-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在Mac下快速调出终端的方法是：为终端添加一个快捷键打开方式</p>
</blockquote>
<h2 id="为终端添加一个快捷键打开方式"><a href="#为终端添加一个快捷键打开方式" class="headerlink" title="为终端添加一个快捷键打开方式"></a>为终端添加一个快捷键打开方式</h2><p>打开Mac下自带的软件 <strong>Automator</strong></p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fckb184f74j319v0q01kx.jpg" alt=""></p>
<p>新建文稿</p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcgy1fckb6zzo28j30mo0fvgn7.jpg" alt=""></p>
<p>创建一个服务</p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcgy1fckb93qmy5j30g00fh0vq.jpg" alt=""></p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fckbfe8o0zj30t10lb0wv.jpg" alt=""></p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcgy1fckbff4e7pj30t10lbwis.jpg" alt=""></p>
<p>修改框内的脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">on run &#123;input, parameters&#125;	tell application &quot;Terminal&quot;		reopen		activate	end tellend run</div></pre></td></tr></table></figure>
<p>运行：<code>command + R</code>，如果没有问题，则会打开终端</p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fckaqdd2m1j30t10lb42a.jpg" alt=""></p>
<p><img src="https://ww3.sinaimg.cn/large/006tKfTcgy1fckaq4nn9hj30iy0daaan.jpg" alt=""></p>
<p>保存：<code>Command + S</code>，将其命名为<code>打开终端</code>或你想要的名字</p>
<p>设置快捷键</p>
<p>在 <strong>系统偏好设置</strong> -&gt; <strong>键盘设置</strong> -&gt; <strong>快捷键</strong> -&gt; <strong>服务</strong></p>
<p>选择我们创建好的 ‘<strong>打开终端</strong>‘，设置你想要的快捷键，比我我设置了<code>⌘+空格</code></p>
<p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fckbvaixhnj30kw0ihq67.jpg" alt=""></p>
<p>到此，设置完成。</p>
<p>聪明的你也许会发现，这个技巧能为所有的程序设置快捷启动。</p>
<p>将脚本中的 <code>Terminal</code> 替换成 其他程序就可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">on run &#123;input, parameters&#125;</div><div class="line">    tell application &quot;Terminal&quot;</div><div class="line">        reopen</div><div class="line">        activate</div><div class="line">    end tell</div><div class="line">end run</div></pre></td></tr></table></figure>
<h2 id="黑技能"><a href="#黑技能" class="headerlink" title="黑技能"></a>黑技能</h2><p>既然学了 <code>Automator</code> ，那就在附上一个黑技能吧。为你的代码排序。在 <strong>Xcode8</strong>以前，有个插件能为代码快速排序，不过时过境迁~ 对于没用的插件而且又有患有强迫症的的小伙伴，只能手动排序了（😂）.</p>
<p>首先还是创建一个服务</p>
<p>创建一个<code>Shell</code>脚本，</p>
<p>勾选:<code>用输出内容替换所选文本</code></p>
<p>输入：<code>sort|uniq</code> </p>
<p>保存： 存为<code>Sort &amp; Uniq</code></p>
<p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fckd40rgwmj30rt0ildiy.jpg" alt=""></p>
<p><strong>选中你的代代码</strong> -&gt; <strong>鼠标右键</strong> -&gt; <strong>Servies</strong> -&gt; <strong>Sort&amp;Uniq</strong></p>
<p><img src="https://ww2.sinaimg.cn/large/006tKfTcgy1fckd6tx1dzj30h90b7mzm.jpg" alt=""></p>
<p>排序后的代码：</p>
<p><img src="https://ww3.sinaimg.cn/large/006tKfTcgy1fckd6lak55j309j05y3yo.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2017-02-04-Hello-2017/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2017-02-04-Hello-2017/" itemprop="url">Hello 2017</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T00:00:00+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>“🙉🙉🙉 ”</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>BY 的 Blog 就这么开通了。</p>
<p>本来打算在年前完成 Blog 的搭建，不曾料想踩了很多坑。。。</p>
<p><a href="#build">跳过废话，直接看技术实现 </a> </p>
<p>2017 年，BY Blog 总算是搭建好了。</p>
<p>最开始写博客是在<a href="www.jianshu.com">简书</a>这个平台上，简书确实不错，支持markdown在线编辑。</p>
<p>在一次偶然间，听到我的好基友 <strong>阳阳</strong> 想搭建个人主页，觉得作为一个程序员，是应该倒腾倒腾自己的Blog，于是乎就开始了撸起袖子干了。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><p id="build"></p></h2><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>接下来说说搭建这个博客的技术细节。  </p>
<p>正好之前就有关注过 <a href="https://pages.github.com/" target="_blank" rel="external">GitHub Pages</a> + <a href="http://jekyllrb.com/" target="_blank" rel="external">Jekyll</a> 快速 Building Blog 的技术方案，非常轻松时尚。</p>
<p>其优点非常明显：</p>
<ul>
<li><strong>Markdown</strong> 带来的优雅写作体验</li>
<li>非常熟悉的 Git workflow ，<strong>Git Commit 即 Blog Post</strong></li>
<li>利用 GitHub Pages 的域名和免费无限空间，不用自己折腾主机<ul>
<li>如果需要自定义域名，也只需要简单改改 DNS 加个 CNAME 就好了 </li>
</ul>
</li>
<li>Jekyll 的自定制非常容易，基本就是个模版引擎</li>
</ul>
<hr>
<p>主题我直接 Downlosd 了 <a href="https://huangxuan.me/" target="_blank" rel="external">Hux的博客主题</a> 的进行修改，简单粗暴，不过遇到了很多坑😂，好在都填完了。。。</p>
<p>本地调试环境需要 <code>gem install jekyll</code>，结果 rubygem 的源居然被墙了，<del>后来手动改成了我大淘宝的镜像源才成功</del>，淘宝的源已经<a href="https://gems.ruby-china.org/" target="_blank" rel="external">停止维护</a>，换成了OSChina的源 <code>https://gems.ruby-china.org/</code>。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>最后，感谢 Hux 提供的的 <a href="https://github.com/Huxpro/huxpro.github.io" target="_blank" rel="external">Blog 主题</a></p>
<p>如果你恰好逛到了这里，希望你也能喜欢这个博客主题，感兴趣的话可以自己动手搭建一个。</p>
<p>—— BY 后记于 2017.2</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2016-10-26-BYPhoneNumTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2016-10-26-BYPhoneNumTF/" itemprop="url">BYPhoneNumTF</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T00:00:00+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>BYPhoneNumTF</strong> 一个电话号码格式的文本框</p>
</blockquote>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>当在<code>TextField</code>输入数字时，会自动分隔为：137 9922 2299 或 137-9922-2299</p>
<p>限制文本输入个数</p>
<p>限制只能输入数字</p>
<h1 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h1><p><img src="http://ww2.sinaimg.cn/large/7853084cgw1fa3cqnu8s2g207i0dc4qp.gif" alt=""></p>
<h1 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h1><p>要实现电话号码格式的输入看似简单，但是实现起来坑非常多，至于坑是什么只有各位动手写了才能体会~</p>
<p>下面我们来实现该功能：</p>
<p>首先要遵守协议<code>&lt;UITextFieldDelegate&gt;</code></p>
<p>然后在<code>- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string</code> 方法中实现我们的逻辑</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line">#import &quot;LoginVC.h&quot;</div><div class="line"></div><div class="line">#define placeholder @&quot; &quot;</div><div class="line"></div><div class="line">@interface LoginVC () &lt;UITextFieldDelegate&gt;</div><div class="line"></div><div class="line">@property (weak, nonatomic) IBOutlet UITextField *phoneNumberTF;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string &#123;</div><div class="line"></div><div class="line">    NSString *phStr = placeholder;</div><div class="line">    unichar phChar = &apos; &apos;;</div><div class="line">    if (phStr.length) &#123;</div><div class="line">        phChar = [phStr characterAtIndex:0];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    if (textField) &#123;</div><div class="line">        NSString* text = textField.text;</div><div class="line">        //删除</div><div class="line">        if([string isEqualToString:@&quot;&quot;])&#123;</div><div class="line">            </div><div class="line">            //删除一位</div><div class="line">            if(range.length == 1)&#123;</div><div class="line">                //最后一位,遇到空格则多删除一次</div><div class="line">                if (range.location == text.length - 1 ) &#123;</div><div class="line">                    if ([text characterAtIndex:text.length - 1] == phChar) &#123;</div><div class="line">                        [textField deleteBackward];</div><div class="line">                    &#125;</div><div class="line">                    return YES;</div><div class="line">                &#125;</div><div class="line">                //从中间删除</div><div class="line">                else&#123;</div><div class="line">                    NSInteger offset = range.location;</div><div class="line">                    </div><div class="line">                    if (range.location &lt; text.length &amp;&amp; [text characterAtIndex:range.location] == phChar &amp;&amp; [textField.selectedTextRange isEmpty]) &#123;</div><div class="line">                        [textField deleteBackward];</div><div class="line">                        offset --;</div><div class="line">                    &#125;</div><div class="line">                    [textField deleteBackward];</div><div class="line">                    textField.text = [self _parseString:textField.text];</div><div class="line">                    UITextPosition *newPos = [textField positionFromPosition:textField.beginningOfDocument offset:offset];</div><div class="line">                    textField.selectedTextRange = [textField textRangeFromPosition:newPos toPosition:newPos];</div><div class="line">                    return NO;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            else if (range.length &gt; 1) &#123;</div><div class="line">                BOOL isLast = NO;</div><div class="line">                //如果是从最后一位开始</div><div class="line">                if(range.location + range.length == textField.text.length )&#123;</div><div class="line">                    isLast = YES;</div><div class="line">                &#125;</div><div class="line">                [textField deleteBackward];</div><div class="line">                textField.text = [self _parseString:textField.text];</div><div class="line">                </div><div class="line">                NSInteger offset = range.location;</div><div class="line">                if (range.location == 3 || range.location  == 8) &#123;</div><div class="line">                    offset ++;</div><div class="line">                &#125;</div><div class="line">                if (isLast) &#123;</div><div class="line">                    //光标直接在最后一位了</div><div class="line">                &#125;else&#123;</div><div class="line">                    UITextPosition *newPos = [textField positionFromPosition:textField.beginningOfDocument offset:offset];</div><div class="line">                    textField.selectedTextRange = [textField textRangeFromPosition:newPos toPosition:newPos];</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            else&#123;</div><div class="line">                return YES;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        else if(string.length &gt;0)&#123;</div><div class="line">            </div><div class="line">            //限制输入字符个数</div><div class="line">            if (([self _noneSpaseString:textField.text].length + string.length - range.length &gt; 11) ) &#123;</div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            //判断是否是纯数字(搜狗，百度输入法，数字键盘居然可以输入其他字符)</div><div class="line">            if(![self _isNum:string])&#123;</div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">            [textField insertText:string];</div><div class="line">            textField.text = [self _parseString:textField.text];</div><div class="line">            </div><div class="line">            NSInteger offset = range.location + string.length;</div><div class="line">            if (range.location == 3 || range.location  == 8) &#123;</div><div class="line">                offset ++;</div><div class="line">            &#125;</div><div class="line">            UITextPosition *newPos = [textField positionFromPosition:textField.beginningOfDocument offset:offset];</div><div class="line">            textField.selectedTextRange = [textField textRangeFromPosition:newPos toPosition:newPos];</div><div class="line">            return NO;</div><div class="line">        &#125;else&#123;</div><div class="line">            return YES;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">    </div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString*)_parseString:(NSString*)string&#123;</div><div class="line">    </div><div class="line">    if (!string) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    NSMutableString* mStr = [NSMutableString stringWithString:[string stringByReplacingOccurrencesOfString:placeholder withString:@&quot;&quot;]];</div><div class="line">    if (mStr.length &gt;3) &#123;</div><div class="line">        [mStr insertString:placeholder atIndex:3];</div><div class="line">    &#125;if (mStr.length &gt; 8) &#123;</div><div class="line">        [mStr insertString:placeholder atIndex:8];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return  mStr;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">/** 获取正常电话号码（去掉空格） */</div><div class="line">- (NSString*)_noneSpaseString:(NSString*)string&#123;</div><div class="line">    </div><div class="line">    return [string stringByReplacingOccurrencesOfString:placeholder withString:@&quot;&quot;];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)_isNum:(NSString *)checkedNumString &#123;</div><div class="line">    </div><div class="line">    if (!checkedNumString) &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    checkedNumString = [checkedNumString stringByTrimmingCharactersInSet:[NSCharacterSet decimalDigitCharacterSet]];</div><div class="line">    </div><div class="line">    if(checkedNumString.length &gt; 0) &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###封装方法</p>
<p>需要实现的代码就是要这么多，但这些代码写在ViewController显得太臃肿了，所以我对代码进行了封装:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">//  BYPhoneNumTF.h</div><div class="line">//</div><div class="line">//  Created by BY on 16/12/2.</div><div class="line">//  Copyright © 2016年 BY. All rights reserved.</div><div class="line">//  电话号码类型的文本输入框，且只能输入数字</div><div class="line">//  输入显示：137 9922 1234 或 137-9922-1234</div><div class="line">//  使用方法：在XIB中的TextField继承该类即可</div><div class="line">//  修改占位符placeholder即可改变样式</div><div class="line"></div><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">// @&quot; &quot; or @&quot;-&quot;</div><div class="line">#define placeholder @&quot; &quot;</div><div class="line"></div><div class="line">@interface BYPhoneNumTF : UITextField</div><div class="line"></div><div class="line">/** 去掉格式的电话号码 */</div><div class="line">@property (nonatomic, strong) NSString *plainPhoneNum;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">//  BYPhoneNumTF.m</div><div class="line">//  dev-Jack</div><div class="line">//</div><div class="line">//  Created by BY on 16/12/2.</div><div class="line">//  Copyright © 2016年 Jack. All rights reserved.</div><div class="line">//</div><div class="line"></div><div class="line">#import &quot;BYPhoneNumTF.h&quot;</div><div class="line"></div><div class="line"></div><div class="line">@interface BYPhoneNumTF ()&lt;UITextFieldDelegate&gt;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation BYPhoneNumTF</div><div class="line"></div><div class="line">- (NSString *)plainPhoneNum &#123;</div><div class="line">    return [self _noneSpaseString:self.text];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)awakeFromNib &#123;</div><div class="line">    [super awakeFromNib];</div><div class="line">    self.delegate = self;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string &#123;</div><div class="line"></div><div class="line">    NSString *phStr = placeholder;</div><div class="line">    unichar phChar = &apos; &apos;;</div><div class="line">    if (phStr.length) &#123;</div><div class="line">        phChar = [phStr characterAtIndex:0];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    if (textField) &#123;</div><div class="line">        NSString* text = textField.text;</div><div class="line">        //删除</div><div class="line">        if([string isEqualToString:@&quot;&quot;])&#123;</div><div class="line">            </div><div class="line">            //删除一位</div><div class="line">            if(range.length == 1)&#123;</div><div class="line">                //最后一位,遇到空格则多删除一次</div><div class="line">                if (range.location == text.length - 1 ) &#123;</div><div class="line">                    if ([text characterAtIndex:text.length - 1] == phChar) &#123;</div><div class="line">                        [textField deleteBackward];</div><div class="line">                    &#125;</div><div class="line">                    return YES;</div><div class="line">                &#125;</div><div class="line">                //从中间删除</div><div class="line">                else&#123;</div><div class="line">                    NSInteger offset = range.location;</div><div class="line">                    </div><div class="line">                    if (range.location &lt; text.length &amp;&amp; [text characterAtIndex:range.location] == phChar &amp;&amp; [textField.selectedTextRange isEmpty]) &#123;</div><div class="line">                        [textField deleteBackward];</div><div class="line">                        offset --;</div><div class="line">                    &#125;</div><div class="line">                    [textField deleteBackward];</div><div class="line">                    textField.text = [self _parseString:textField.text];</div><div class="line">                    UITextPosition *newPos = [textField positionFromPosition:textField.beginningOfDocument offset:offset];</div><div class="line">                    textField.selectedTextRange = [textField textRangeFromPosition:newPos toPosition:newPos];</div><div class="line">                    return NO;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            else if (range.length &gt; 1) &#123;</div><div class="line">                BOOL isLast = NO;</div><div class="line">                //如果是从最后一位开始</div><div class="line">                if(range.location + range.length == textField.text.length )&#123;</div><div class="line">                    isLast = YES;</div><div class="line">                &#125;</div><div class="line">                [textField deleteBackward];</div><div class="line">                textField.text = [self _parseString:textField.text];</div><div class="line">                </div><div class="line">                NSInteger offset = range.location;</div><div class="line">                if (range.location == 3 || range.location  == 8) &#123;</div><div class="line">                    offset ++;</div><div class="line">                &#125;</div><div class="line">                if (isLast) &#123;</div><div class="line">                    //光标直接在最后一位了</div><div class="line">                &#125;else&#123;</div><div class="line">                    UITextPosition *newPos = [textField positionFromPosition:textField.beginningOfDocument offset:offset];</div><div class="line">                    textField.selectedTextRange = [textField textRangeFromPosition:newPos toPosition:newPos];</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            else&#123;</div><div class="line">                return YES;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        else if(string.length &gt;0)&#123;</div><div class="line">            </div><div class="line">            //限制输入字符个数</div><div class="line">            if (([self _noneSpaseString:textField.text].length + string.length - range.length &gt; 11) ) &#123;</div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            //判断是否是纯数字(搜狗，百度输入法，数字键盘居然可以输入其他字符)</div><div class="line">            if(![self _isNum:string])&#123;</div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">            [textField insertText:string];</div><div class="line">            textField.text = [self _parseString:textField.text];</div><div class="line">            </div><div class="line">            NSInteger offset = range.location + string.length;</div><div class="line">            if (range.location == 3 || range.location  == 8) &#123;</div><div class="line">                offset ++;</div><div class="line">            &#125;</div><div class="line">            UITextPosition *newPos = [textField positionFromPosition:textField.beginningOfDocument offset:offset];</div><div class="line">            textField.selectedTextRange = [textField textRangeFromPosition:newPos toPosition:newPos];</div><div class="line">            return NO;</div><div class="line">        &#125;else&#123;</div><div class="line">            return YES;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">    </div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString*)_parseString:(NSString*)string&#123;</div><div class="line">    </div><div class="line">    if (!string) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    NSMutableString* mStr = [NSMutableString stringWithString:[string stringByReplacingOccurrencesOfString:placeholder withString:@&quot;&quot;]];</div><div class="line">    if (mStr.length &gt;3) &#123;</div><div class="line">        [mStr insertString:placeholder atIndex:3];</div><div class="line">    &#125;if (mStr.length &gt; 8) &#123;</div><div class="line">        [mStr insertString:placeholder atIndex:8];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return  mStr;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">/** 获取正常电话号码（去掉空格） */</div><div class="line">- (NSString*)_noneSpaseString:(NSString*)string&#123;</div><div class="line">    </div><div class="line">    return [string stringByReplacingOccurrencesOfString:placeholder withString:@&quot;&quot;];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)_isNum:(NSString *)checkedNumString &#123;</div><div class="line">    </div><div class="line">    if (!checkedNumString) &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    checkedNumString = [checkedNumString stringByTrimmingCharactersInSet:[NSCharacterSet decimalDigitCharacterSet]];</div><div class="line">    </div><div class="line">    if(checkedNumString.length &gt; 0) &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><p>在storyboard中的<code>TextField</code>控件的Calss类型选择该类<code>BYPhoneNumTF</code>即可。</p>
<p>代码及Demo下载地址：<a href="https://github.com/qiubaiying/BYPhoneNumTF" target="_blank" rel="external">BYPhoneNumTF</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/06/2016-01-06-ReactiveCocoa-进阶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/06/2016-01-06-ReactiveCocoa-进阶/" itemprop="url">ReactiveCocoa 进阶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-06T00:00:00+08:00">
                2017-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>在<a href="http://qiubaiying.github.io/2016/12/26/ReactiveCocoa-基础/" target="_blank" rel="external">上篇文章</a>中介绍了<strong>ReactiveCocoa</strong>的基础知识,接下来我们来深入介绍<strong>ReactiveCocoa</strong>及其在<strong>MVVM</strong>中的用法。</p>
</blockquote>
<p><img src="https://ww3.sinaimg.cn/large/006y8lVagw1fbgye3re5xj30je0iomz8.jpg" alt="ReactiveCocoa进阶思维导图"></p>
<h1 id="常见操作方法介绍"><a href="#常见操作方法介绍" class="headerlink" title="常见操作方法介绍"></a>常见操作方法介绍</h1><h4 id="操作须知"><a href="#操作须知" class="headerlink" title="操作须知"></a>操作须知</h4><p>所有的信号（RACSignal）都可以进行操作处理，因为所有操作方法都定义在RACStream.h中，因此只要继承RACStream就有了操作处理方法。</p>
<h4 id="操作思想"><a href="#操作思想" class="headerlink" title="操作思想"></a>操作思想</h4><p>运用的是Hook（钩子）思想，Hook是一种用于改变API(应用程序编程接口：方法)执行结果的技术.</p>
<p>Hook用处：截获API调用的技术。</p>
<p>有关Hook的知识可以看我的这篇博客<a href="http://www.jianshu.com/p/ff114e69cc0a" target="_blank" rel="external">《Objective-C Runtime 的一些基本使用》</a>中的 <em>更换代码的实现方法</em> 一节,</p>
<p>Hook原理：在每次调用一个API返回结果之前，先执行你自己的方法，改变结果的输出。</p>
<h4 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h4><h4 id="bind（绑定）-ReactiveCocoa核心方法"><a href="#bind（绑定）-ReactiveCocoa核心方法" class="headerlink" title="bind（绑定）- ReactiveCocoa核心方法"></a><strong>bind</strong>（绑定）- ReactiveCocoa核心方法</h4><p><strong>ReactiveCocoa</strong> 操作的核心方法是 <strong>bind</strong>（绑定）,而且也是RAC中核心开发方式。之前的开发方式是赋值，而用RAC开发，应该把重心放在绑定，也就是可以在创建一个对象的时候，就绑定好以后想要做的事情，而不是等赋值之后在去做事情。</p>
<p>列如，把数据展示到控件上，之前都是重写控件的 <code>setModel</code> 方法，用RAC就可以在一开始创建控件的时候，就绑定好数据。</p>
<ul>
<li><p><strong>作用</strong></p>
<p>  RAC底层都是调用<strong>bind</strong>， 在开发中很少直接使用 <strong>bind</strong> 方法，<strong>bind</strong>属于RAC中的底层方法，我们只需要调用封装好的方法，<strong>bind</strong>用作了解即可.</p>
</li>
<li><p><strong>bind方法使用步骤</strong></p>
<ol>
<li>传入一个返回值 <code>RACStreamBindBlock</code> 的 block。</li>
<li>描述一个 <code>RACStreamBindBlock</code> 类型的 <code>bindBlock</code>作为block的返回值。</li>
<li><p>描述一个返回结果的信号，作为 <code>bindBlock</code> 的返回值。</p>
<p>注意：在bindBlock中做信号结果的处理。</p>
</li>
</ol>
</li>
<li><p><strong>bind方法参数</strong></p>
<p><strong>RACStreamBindBlock</strong>:<br><code>typedef RACStream * (^RACStreamBindBlock)(id value, BOOL *stop);</code></p>
<p><code>参数一(value)</code>:表示接收到信号的原始值，还没做处理</p>
<p><code>参数二(*stop)</code>:用来控制绑定Block，如果*stop = yes,那么就会结束绑定。</p>
<p><code>返回值</code>：信号，做好处理，在通过这个信号返回出去，一般使用 <code>RACReturnSignal</code>,需要手动导入头文件<code>RACReturnSignal.h</code></p>
</li>
<li><p><strong>使用</strong></p>
<p>  假设想监听文本框的内容，并且在每次输出结果的时候，都在文本框的内容拼接一段文字“输出：”</p>
<ul>
<li><p>使用封装好的方法：在返回结果后，拼接。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[_textField.rac_textSignal subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line">	// 在返回结果后，拼接 输出：</div><div class="line">	NSLog(@&quot;输出:%@&quot;,x);</div><div class="line"></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
</li>
<li><p>方式二:，使用RAC中 <code>bind</code> 方法做处理，在返回结果前，拼接。</p>
<p>  这里需要手动导入<code>#import &lt;ReactiveCocoa/RACReturnSignal.h&gt;</code>，才能使用<code>RACReturnSignal</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[[_textField.rac_textSignal bind:^RACStreamBindBlock&#123;</div><div class="line">   // 什么时候调用:</div><div class="line">   // block作用:表示绑定了一个信号.</div><div class="line"></div><div class="line">   return ^RACStream *(id value, BOOL *stop)&#123;</div><div class="line"></div><div class="line">       // 什么时候调用block:当信号有新的值发出，就会来到这个block。</div><div class="line"></div><div class="line">       // block作用:做返回值的处理</div><div class="line"></div><div class="line">       // 做好处理，在返回结果前，拼接 输出:</div><div class="line">       return [RACReturnSignal return:[NSString stringWithFormat:@&quot;输出:%@&quot;,value]];</div><div class="line">   &#125;;</div><div class="line"></div><div class="line">&#125;] subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line">   NSLog(@&quot;%@&quot;,x);</div><div class="line"></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li>源信号调用bind,会重新创建一个绑定信号。</li>
<li>当绑定信号被订阅，就会调用绑定信号中的 <code>didSubscribe</code> ，生成一个 <code>bindingBlock</code> 。</li>
<li>当源信号有内容发出，就会把内容传递到 <code>bindingBlock</code> 处理，调用<code>bindingBlock(value,stop)</code></li>
<li>调用<code>bindingBlock(value,stop)</code>，会返回一个内容处理完成的信号<code>RACReturnSignal</code>。</li>
<li><p>订阅<code>RACReturnSignal</code>，就会拿到绑定信号的订阅者，把处理完成的信号内容发送出来。</p>
<p>注意:不同订阅者，保存不同的nextBlock，看源码的时候，一定要看清楚订阅者是哪个。</p>
</li>
</ol>
</li>
</ul>
<h4 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h4><p>映射主要用这两个方法实现：<strong>flattenMap</strong>,<strong>Map</strong>,用于把源信号内容映射成新的内容。</p>
<h6 id="flattenMap"><a href="#flattenMap" class="headerlink" title="flattenMap"></a>flattenMap</h6><ul>
<li><p><strong>作用</strong></p>
<p>  把源信号的内容映射成一个新的信号，信号可以是任意类型</p>
</li>
<li><p><strong>使用步骤</strong></p>
<ol>
<li>传入一个block，block类型是返回值<code>RACStream</code>，参数value</li>
<li>参数value就是源信号的内容，拿到源信号的内容做处理</li>
<li>包装成<code>RACReturnSignal</code>信号，返回出去。</li>
</ol>
</li>
</ul>
<ul>
<li><p><strong>使用</strong></p>
<p>  监听文本框的内容改变，把结构重新映射成一个新值.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[[_textField.rac_textSignal flattenMap:^RACStream *(id value) &#123;</div><div class="line">       </div><div class="line">       // block调用时机：信号源发出的时候</div><div class="line">       </div><div class="line">       // block作用：改变信号的内容</div><div class="line">       </div><div class="line">       // 返回RACReturnSignal</div><div class="line">       return [RACReturnSignal return:[NSString stringWithFormat:@&quot;信号内容：%@&quot;, value]];</div><div class="line">       </div><div class="line">   &#125;] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div></pre></td></tr></table></figure>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li><strong>flattenMap</strong>内部调用 <code>bind</code> 方法实现的,<strong>flattenMap</strong>中block的返回值，会作为bind中bindBlock的返回值。</li>
<li>当订阅绑定信号，就会生成 <code>bindBlock</code>。</li>
<li>当源信号发送内容，就会调用<code>bindBlock(value, *stop)</code></li>
<li>调用<code>bindBlock</code>，内部就会调用 <strong>flattenMap</strong> 的 bloc k，<strong>flattenMap</strong> 的block作用：就是把处理好的数据包装成信号。</li>
<li>返回的信号最终会作为 <code>bindBlock</code> 中的返回信号，当做 <code>bindBlock</code> 的返回信号。</li>
<li>订阅 <code>bindBlock</code> 的返回信号，就会拿到绑定信号的订阅者，把处理完成的信号内容发送出来。</li>
</ol>
</li>
</ul>
<h6 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h6><ul>
<li><p><strong>作用</strong></p>
<p>  把源信号的值映射成一个新的值</p>
</li>
</ul>
<ul>
<li><p><strong>使用步骤</strong></p>
<ol>
<li>传入一个block,类型是返回对象，参数是 <code>value</code></li>
<li><code>value</code>就是源信号的内容，直接拿到源信号的内容做处理</li>
<li>把处理好的内容，直接返回就好了，不用包装成信号，返回的值，就是映射的值。</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
<p>  监听文本框的内容改变，把结构重新映射成一个新值.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[[_textField.rac_textSignal map:^id(id value) &#123;</div><div class="line">      </div><div class="line">      // 拼接完后，返回对象</div><div class="line">       return [NSString stringWithFormat:@&quot;信号内容: %@&quot;, value];</div><div class="line">       </div><div class="line">   &#125;] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div></pre></td></tr></table></figure>
</li>
<li><p><strong>底层实现</strong>:</p>
<ol>
<li>Map底层其实是调用 <code>flatternMa</code>p,<code>Map</code> 中block中的返回的值会作为 <code>flatternMap</code> 中block中的值</li>
<li>当订阅绑定信号，就会生成 <code>bindBlock</code> </li>
<li>当源信号发送内容，就会调用 <code>bindBlock(value, *stop)</code></li>
<li>调用 <code>bindBlock</code> ，内部就会调用 <code>flattenMap的block</code></li>
<li><code>flattenMap的block</code> 内部会调用 <code>Map</code> 中的block，把 <code>Map</code> 中的block返回的内容包装成返回的信号</li>
<li>返回的信号最终会作为 <code>bindBlock</code> 中的返回信号，当做 <code>bindBlock</code> 的返回信号</li>
<li>订阅 <code>bindBlock</code> 的返回信号，就会拿到绑定信号的订阅者，把处理完成的信号内容发送出来。</li>
</ol>
</li>
</ul>
<h6 id="FlatternMap-和-Map-的区别"><a href="#FlatternMap-和-Map-的区别" class="headerlink" title="FlatternMap 和 Map 的区别"></a>FlatternMap 和 Map 的区别</h6><ul>
<li><strong>FlatternMap</strong> 中的Block <strong>返回信号</strong>。 </li>
</ul>
<ol>
<li><strong>Map</strong> 中的Block <strong>返回对象</strong>。</li>
<li>开发中，如果信号发出的值 <strong>不是信号</strong> ，映射一般使用 <code>Map</code></li>
<li>如果信号发出的值 <strong>是信号</strong>，映射一般使用 <code>FlatternMap</code>。</li>
</ol>
<ul>
<li><p><code>signalOfsignals</code>用 <strong>FlatternMap</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// 创建信号中的信号</div><div class="line">RACSubject *signalOfsignals = [RACSubject subject];</div><div class="line">RACSubject *signal = [RACSubject subject];</div><div class="line"></div><div class="line">[[signalOfsignals flattenMap:^RACStream *(id value) &#123;</div><div class="line"></div><div class="line"> // 当signalOfsignals的signals发出信号才会调用</div><div class="line"></div><div class="line">    return value;</div><div class="line"></div><div class="line">&#125;] subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line">    // 只有signalOfsignals的signal发出信号才会调用，因为内部订阅了bindBlock中返回的信号，也就是flattenMap返回的信号。</div><div class="line">    // 也就是flattenMap返回的信号发出内容，才会调用。</div><div class="line"></div><div class="line">    NSLog(@&quot;signalOfsignals：%@&quot;,x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 信号的信号发送信号</div><div class="line">[signalOfsignals sendNext:signal];</div><div class="line"></div><div class="line">// 信号发送内容</div><div class="line">[signal sendNext:@&quot;hi&quot;];</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h4><p>组合就是将多个信号按照某种规则进行拼接，合成新的信号。</p>
<h6 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h6><ul>
<li><p><strong>作用</strong> </p>
<p>  按<strong>顺序拼接</strong>信号，当多个信号发出的时候，有顺序的接收信号。</p>
</li>
<li><strong>底层实现</strong><ol>
<li>当拼接信号被订阅，就会调用拼接信号的didSubscribe</li>
<li>didSubscribe中，会先订阅第一个源信号（signalA）</li>
<li>会执行第一个源信号（signalA）的didSubscribe</li>
<li>第一个源信号（signalA）didSubscribe中发送值，就会调用第一个源信号（signalA）订阅者的nextBlock,通过拼接信号的订阅者把值发送出来.</li>
<li>第一个源信号（signalA）didSubscribe中发送完成，就会调用第一个源信号（signalA）订阅者的completedBlock,订阅第二个源信号（signalB）这时候才激活（signalB）。</li>
<li>订阅第二个源信号（signalB）,执行第二个源信号（signalB）的didSubscribe</li>
<li>第二个源信号（signalA）didSubscribe中发送值,就会通过拼接信号的订阅者把值发送出来.</li>
</ol>
</li>
<li><p><strong>使用步骤</strong></p>
<ol>
<li>使用<code>concat:</code>拼接信号</li>
<li>订阅拼接信号，内部会自动按拼接顺序订阅信号</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
<p>  拼接信号 <code>signalA</code>、 <code>signalB</code>、 <code>signalC</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;Hello&quot;];</div><div class="line">       </div><div class="line">       [subscriber sendCompleted];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;World&quot;];</div><div class="line">       </div><div class="line">       [subscriber sendCompleted];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *signalC = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;!&quot;];</div><div class="line">       </div><div class="line">       [subscriber sendCompleted];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   // 拼接 A B, 把signalA拼接到signalB后，signalA发送完成，signalB才会被激活。</div><div class="line">   RACSignal *concatSignalAB = [signalA concat:signalB];</div><div class="line">   </div><div class="line">   // A B + C</div><div class="line">   RACSignal *concatSignalABC = [concatSignalAB concat:signalC];</div><div class="line">   </div><div class="line">   </div><div class="line">   // 订阅拼接的信号, 内部会按顺序订阅 A-&gt;B-&gt;C</div><div class="line">   // 注意：第一个信号必须发送完成，第二个信号才会被激活...</div><div class="line">   [concatSignalABC subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="then"><a href="#then" class="headerlink" title="then"></a>then</h6><ul>
<li><p><strong>作用</strong> </p>
<p>  用于连接两个信号，当第一个信号完成，才会连接then返回的信号。</p>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li>先过滤掉之前的信号发出的值</li>
<li>使用concat连接then返回的信号</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">   </div><div class="line">   [subscriber sendNext:@1];</div><div class="line">   </div><div class="line">   [subscriber sendCompleted];</div><div class="line">   </div><div class="line">   return nil;</div><div class="line">   </div><div class="line"> &#125;] then:^RACSignal *&#123;</div><div class="line">   </div><div class="line">   	return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@2];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line"> &#125;] subscribeNext:^(id x) &#123;</div><div class="line">   </div><div class="line">   // 只能接收到第二个信号的值，也就是then返回信号的值</div><div class="line">   NSLog(@&quot;%@&quot;, x);</div><div class="line">   </div><div class="line"> &#125;];</div><div class="line"> </div><div class="line"> ///</div><div class="line"> 输出：2</div></pre></td></tr></table></figure>
</li>
<li><p><strong>注意</strong></p>
<p>  注意使用<code>then</code>，之前信号的值会被忽略掉.</p>
</li>
</ul>
<h6 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h6><ul>
<li><p><strong>作用</strong> </p>
<p>  合并信号,任何一个信号发送数据，都能监听到.</p>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li>合并信号被订阅的时候，就会遍历所有信号，并且发出这些信号。</li>
<li>每发出一个信号，这个信号就会被订阅</li>
<li>也就是合并信号一被订阅，就会订阅里面所有的信号。</li>
<li>只要有一个信号被发出就会被监听。</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;A&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line"></div><div class="line">   RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;B&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line"></div><div class="line">   // 合并信号, 任何一个信号发送数据，都能监听到</div><div class="line">   RACSignal *mergeSianl = [signalA merge:signalB];</div><div class="line"></div><div class="line">   [mergeSianl subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   // 输出</div><div class="line">2017-01-03 13:29:08.013 ReactiveCocoa进阶[3627:718315] A</div><div class="line">2017-01-03 13:29:08.014 ReactiveCocoa进阶[3627:718315] B</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h6><ul>
<li><p><strong>作用</strong> </p>
<p>  把两个信号压缩成一个信号，只有当两个信号 <strong>同时</strong> 发出信号内容时，并且把两个信号的内容合并成一个元组，才会触发压缩流的next事件。</p>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li>定义压缩信号，内部就会自动订阅signalA，signalB</li>
<li>每当signalA或者signalB发出信号，就会判断signalA，signalB有没有发出个信号，有就会把每个信号 第一次 发出的值包装成元组发出</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;A1&quot;];</div><div class="line">       [subscriber sendNext:@&quot;A2&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;B1&quot;];</div><div class="line">       [subscriber sendNext:@&quot;B2&quot;];</div><div class="line">       [subscriber sendNext:@&quot;B3&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *zipSignal = [signalA zipWith:signalB];</div><div class="line">   </div><div class="line">   [zipSignal subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line"></div><div class="line">// 输出</div><div class="line">2017-01-03 13:48:09.234 ReactiveCocoa进阶[3997:789720] zipWith: &lt;RACTuple: 0x600000004df0&gt; (</div><div class="line">   A1,</div><div class="line">   B1</div><div class="line">)</div><div class="line">2017-01-03 13:48:09.234 ReactiveCocoa进阶[3997:789720] zipWith: &lt;RACTuple: 0x608000003410&gt; (</div><div class="line">   A2,</div><div class="line">   B2</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h6><ul>
<li><p><strong>作用</strong> </p>
<p>  将多个信号合并起来，并且拿到各个信号最后一个值,必须每个合并的signal至少都有过一次sendNext，才会触发合并的信号。</p>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li>当组合信号被订阅，内部会自动订阅signalA，signalB,必须两个信号都发出内容，才会被触发。</li>
<li>并且把两个信号的 最后一次 发送的值组合成元组发出。</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;A1&quot;];</div><div class="line">       [subscriber sendNext:@&quot;A2&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;B1&quot;];</div><div class="line">       [subscriber sendNext:@&quot;B2&quot;];</div><div class="line">       [subscriber sendNext:@&quot;B3&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *combineSianal = [signalA combineLatestWith:signalB];</div><div class="line">   </div><div class="line">   [combineSianal subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;combineLatest:%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line"></div><div class="line">// 输出</div><div class="line">2017-01-03 13:48:09.235 ReactiveCocoa进阶[3997:789720] combineLatest:&lt;RACTuple: 0x60800000e150&gt; (</div><div class="line">   A2,</div><div class="line">   B1</div><div class="line">)</div><div class="line">2017-01-03 13:48:09.235 ReactiveCocoa进阶[3997:789720] combineLatest:&lt;RACTuple: 0x600000004db0&gt; (</div><div class="line">   A2,</div><div class="line">   B2</div><div class="line">)</div><div class="line">2017-01-03 13:48:09.236 ReactiveCocoa进阶[3997:789720] combineLatest:&lt;RACTuple: 0x60800000e180&gt; (</div><div class="line">   A2,</div><div class="line">   B3</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>注意</strong></p>
<p>  <strong>combineLatest</strong>与<strong>zip</strong>用法相似，必须每个合并的signal至少都有过一次sendNext，才会触发合并的信号。</p>
<p>  区别看下图：</p>
<p>  <img src="https://ww2.sinaimg.cn/large/006y8lVagw1fbdf6cyez6j30id0kkabf.jpg" alt=""></p>
</li>
</ul>
<h6 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h6><ul>
<li><p><strong>作用</strong> </p>
<p>  把信号发出元组的值聚合成一个值</p>
</li>
<li><p><strong>底层实现</strong></p>
<ol>
<li>订阅聚合信号，</li>
<li>每次有内容发出，就会执行reduceblcok，把信号内容转换成reduceblcok返回的值。</li>
</ol>
</li>
<li><p><strong>使用</strong></p>
<p>   常见的用法，（先组合在聚合）<code>combineLatest:(id&lt;NSFastEnumeration&gt;)signals reduce:(id (^)())reduceBlock</code></p>
<p>   reduce中的block简介:</p>
<p>   reduceblcok中的参数，有多少信号组合，reduceblcok就有多少参数，每个参数就是之前信号发出的内容<br>   reduceblcok的返回值：聚合信号之后的内容。</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">    RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;A1&quot;];</div><div class="line">       [subscriber sendNext:@&quot;A2&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;B1&quot;];</div><div class="line">       [subscriber sendNext:@&quot;B2&quot;];</div><div class="line">       [subscriber sendNext:@&quot;B3&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   </div><div class="line">   RACSignal *reduceSignal = [RACSignal combineLatest:@[signalA, signalB] reduce:^id(NSString *str1, NSString *str2)&#123;</div><div class="line">       </div><div class="line">       return [NSString stringWithFormat:@&quot;%@ %@&quot;, str1, str2];</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   [reduceSignal subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   // 输出</div><div class="line">   2017-01-03 15:42:41.803 ReactiveCocoa进阶[4248:1264674] A2 B1</div><div class="line">2017-01-03 15:42:41.803 ReactiveCocoa进阶[4248:1264674] A2 B2</div><div class="line">2017-01-03 15:42:41.803 ReactiveCocoa进阶[4248:1264674] A2 B3</div></pre></td></tr></table></figure>
</code></pre><h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h4><p>过滤就是过滤信号中的 特定值 ，或者过滤指定 发送次数 的信号。</p>
<h6 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h6><ul>
<li><p><strong>作用</strong></p>
<p>  过滤信号，使用它可以获取满足条件的信号.</p>
<p>  block的返回值是Bool值，返回<code>NO</code>则过滤该信号</p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// 过滤:</div><div class="line">// 每次信号发出，会先执行过滤条件判断.</div><div class="line">[[_textField.rac_textSignal filter:^BOOL(NSString *value) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;原信号: %@&quot;, value);</div><div class="line"></div><div class="line">       // 过滤 长度 &lt;= 3 的信号</div><div class="line">       return value.length &gt; 3;</div><div class="line">       </div><div class="line">   &#125;] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;长度大于3的信号：%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   // 在_textField中输出12345</div><div class="line">// 输出</div><div class="line">2017-01-03 16:36:54.938 ReactiveCocoa进阶[4714:1552910] 原信号: 1</div><div class="line">2017-01-03 16:36:55.383 ReactiveCocoa进阶[4714:1552910] 原信号: 12</div><div class="line">2017-01-03 16:36:55.706 ReactiveCocoa进阶[4714:1552910] 原信号: 123</div><div class="line">2017-01-03 16:36:56.842 ReactiveCocoa进阶[4714:1552910] 原信号: 1234</div><div class="line">2017-01-03 16:36:56.842 ReactiveCocoa进阶[4714:1552910] 长度大于3的信号：1234</div><div class="line">2017-01-03 16:36:58.350 ReactiveCocoa进阶[4714:1552910] 原信号: 12345</div><div class="line">2017-01-03 16:36:58.351 ReactiveCocoa进阶[4714:1552910] 长度大于3的信号：12345</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="ignore"><a href="#ignore" class="headerlink" title="ignore"></a>ignore</h6><ul>
<li><p><strong>作用</strong></p>
<p>  忽略某些信号.</p>
</li>
<li><p><strong>使用</strong></p>
</li>
<li><p><strong>作用</strong></p>
<p>  忽略某些值的信号.</p>
<p>  底层调用了 <code>filter</code> 与 过滤值进行比较，若相等返回则 <code>NO</code></p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">  	// 内部调用filter过滤，忽略掉字符为 @“1”的值</div><div class="line">[[_textField.rac_textSignal ignore:@&quot;1&quot;] subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line"> 	 NSLog(@&quot;%@&quot;,x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="distinctUntilChanged"><a href="#distinctUntilChanged" class="headerlink" title="distinctUntilChanged"></a>distinctUntilChanged</h6><ul>
<li><p><strong>作用</strong></p>
<p>  当上一次的值和当前的值有明显的变化就会发出信号，否则会被忽略掉。</p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[_textField.rac_textSignal distinctUntilChanged] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;,x);</div><div class="line">   &#125;];</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h6><ul>
<li><p><strong>作用</strong></p>
<p>  跳过 <strong>第N次</strong> 的发送的信号.</p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 表示输入第一次，不会被监听到，跳过第一次发出的信号</div><div class="line">[[_textField.rac_textSignal skip:1] subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line">   NSLog(@&quot;%@&quot;,x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="take"><a href="#take" class="headerlink" title="take"></a>take</h5><ul>
<li><p><strong>作用</strong></p>
<p>  取 <strong>前N次</strong> 的发送的信号.</p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">RACSubject *subject = [RACSubject subject] ;</div><div class="line">   </div><div class="line">   // 取 前两次 发送的信号</div><div class="line">   [[subject take:2] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   [subject sendNext:@1];</div><div class="line">   [subject sendNext:@2];</div><div class="line">   [subject sendNext:@3];</div><div class="line">   </div><div class="line">   // 输出</div><div class="line">2017-01-03 17:35:54.566 ReactiveCocoa进阶[4969:1677908] 1</div><div class="line">2017-01-03 17:35:54.567 ReactiveCocoa进阶[4969:1677908] 2</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="takeLast"><a href="#takeLast" class="headerlink" title="takeLast"></a>takeLast</h6><ul>
<li><p><strong>作用</strong></p>
<p>  取 <strong>最后N次</strong> 的发送的信号</p>
<p>  前提条件，订阅者必须调用完成 <code>sendCompleted</code>，因为只有完成，就知道总共有多少信号.</p>
</li>
<li><p><strong>使用</strong>    </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">RACSubject *subject = [RACSubject subject] ;</div><div class="line">   </div><div class="line">   // 取 后两次 发送的信号</div><div class="line">   [[subject takeLast:2] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   [subject sendNext:@1];</div><div class="line">   [subject sendNext:@2];</div><div class="line">   [subject sendNext:@3];</div><div class="line">   </div><div class="line">   // 必须 跳用完成</div><div class="line">   [subject sendCompleted];</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="takeUntil"><a href="#takeUntil" class="headerlink" title="takeUntil"></a>takeUntil</h6><ul>
<li><p><strong>作用</strong></p>
<p>  获取信号直到某个信号执行完成</p>
</li>
<li><p><strong>使用</strong>    </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">	// 监听文本框的改变直到当前对象被销毁</div><div class="line">[_textField.rac_textSignal takeUntil:self.rac_willDeallocSignal];</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="switchToLatest"><a href="#switchToLatest" class="headerlink" title="switchToLatest"></a>switchToLatest</h6><ul>
<li><p><strong>作用</strong></p>
<p>  用于signalOfSignals（信号的信号），有时候信号也会发出信号，会在signalOfSignals中，获取signalOfSignals发送的最新信号。</p>
</li>
<li><p><strong>注意</strong></p>
<p>  switchToLatest：只能用于信号中的信号</p>
</li>
<li><p><strong>使用</strong>    </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">RACSubject *signalOfSignals = [RACSubject subject];</div><div class="line">   RACSubject *signal = [RACSubject subject];</div><div class="line">   </div><div class="line">   // 获取信号中信号最近发出信号，订阅最近发出的信号。</div><div class="line">   [signalOfSignals.switchToLatest subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   [signalOfSignals sendNext:signal];</div><div class="line">   [signal sendNext:@1];</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="秩序"><a href="#秩序" class="headerlink" title="秩序"></a>秩序</h4><p>秩序包括 <code>doNext</code> 和 <code>doCompleted</code> 这两个方法，主要是在 执行<code>sendNext</code> 或者 <code>sendCompleted</code>之前，先执行这些方法中Block。</p>
<h6 id="doNext"><a href="#doNext" class="headerlink" title="doNext"></a>doNext</h6><p>执行<code>sendNext</code>之前，会先执行这个<code>doNext</code>的 Block</p>
<h6 id="doCompleted"><a href="#doCompleted" class="headerlink" title="doCompleted"></a>doCompleted</h6><p>执行<code>sendCompleted</code>之前，会先执行这<code>doCompleted</code>的<code>Block</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[[[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    </div><div class="line">    [subscriber sendNext:@&quot;hi&quot;];</div><div class="line">    </div><div class="line">    [subscriber sendCompleted];</div><div class="line">    </div><div class="line">    return nil;</div><div class="line">    </div><div class="line">&#125;] doNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    // 执行 [subscriber sendNext:@&quot;hi&quot;] 之前会调用这个 Block</div><div class="line">    NSLog(@&quot;doNext&quot;);</div><div class="line">    </div><div class="line">&#125;] doCompleted:^&#123;</div><div class="line">    </div><div class="line">    // 执行 [subscriber sendCompleted] 之前会调用这 Block</div><div class="line">    NSLog(@&quot;doCompleted&quot;);</div><div class="line">&#125;] subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;%@&quot;, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><p><strong>ReactiveCocoa</strong> 中的线程操作 包括 <code>deliverOn</code> 和 <code>subscribeOn</code>这两种，将 <em>传递的内容</em> 或 创建信号时 <em>block中的代码</em> 切换到指定的线程中执行。</p>
<h6 id="deliverOn"><a href="#deliverOn" class="headerlink" title="deliverOn"></a>deliverOn</h6><ul>
<li><p><strong>作用</strong></p>
<p>  内容传递切换到制定线程中，副作用在原来线程中,把在创建信号时block中的代码称之为副作用。</p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">	// 在子线程中执行</div><div class="line">	dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        </div><div class="line">        [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        </div><div class="line">            NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">            </div><div class="line">            [subscriber sendNext:@123];</div><div class="line">            </div><div class="line">            [subscriber sendCompleted];</div><div class="line">            </div><div class="line">            return nil;</div><div class="line">        &#125;]</div><div class="line">          deliverOn:[RACScheduler mainThreadScheduler]]</div><div class="line">          </div><div class="line">         subscribeNext:^(id x) &#123;</div><div class="line">         </div><div class="line">             NSLog(@&quot;%@&quot;, x);</div><div class="line">             </div><div class="line">             NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">         &#125;];</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    // 输出</div><div class="line">2017-01-04 10:35:55.415 ReactiveCocoa进阶[1183:224535] &lt;NSThread: 0x608000270f00&gt;&#123;number = 3, name = (null)&#125;</div><div class="line">2017-01-04 10:35:55.415 ReactiveCocoa进阶[1183:224482] 123</div><div class="line">2017-01-04 10:35:55.415 ReactiveCocoa进阶[1183:224482] &lt;NSThread: 0x600000079bc0&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>可以看到`副作用`在 *子线程* 中执行，而 `传递的内容` 在 *主线程* 中接收
</code></pre><h6 id="subscribeOn"><a href="#subscribeOn" class="headerlink" title="subscribeOn"></a>subscribeOn</h6><ul>
<li><p><strong>作用</strong></p>
<p>  <strong>subscribeOn</strong>则是将 <code>内容传递</code> 和 <code>副作用</code> 都会切换到指定线程中</p>
</li>
<li><p><strong>使用</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">        </div><div class="line">        [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        </div><div class="line">            NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">            </div><div class="line">            [subscriber sendNext:@123];</div><div class="line">            </div><div class="line">            [subscriber sendCompleted];</div><div class="line">            </div><div class="line">            return nil;</div><div class="line">        &#125;]</div><div class="line">          subscribeOn:[RACScheduler mainThreadScheduler]] //传递的内容到主线程中</div><div class="line">         subscribeNext:^(id x) &#123;</div><div class="line">         </div><div class="line">             NSLog(@&quot;%@&quot;, x);</div><div class="line">             </div><div class="line">             NSLog(@&quot;%@&quot;, [NSThread currentThread]);</div><div class="line">         &#125;];</div><div class="line">    &#125;);	</div><div class="line">	//</div><div class="line">2017-01-04 10:44:47.558 ReactiveCocoa进阶[1243:275126] &lt;NSThread: 0x608000077640&gt;&#123;number = 1, name = main&#125;</div><div class="line">2017-01-04 10:44:47.558 ReactiveCocoa进阶[1243:275126] 123</div><div class="line">2017-01-04 10:44:47.558 ReactiveCocoa进阶[1243:275126] &lt;NSThread: 0x608000077640&gt;&#123;number = 1, name = main&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>`内容传递` 和 `副作用` 都切换到了 *主线程* 执行
</code></pre><h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>时间操作就会设置信号超时，定时和延时。</p>
<h6 id="interval-定时"><a href="#interval-定时" class="headerlink" title="interval 定时"></a>interval 定时</h6><ul>
<li><p><strong>作用</strong></p>
<p>  定时：每隔一段时间发出信号</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 每隔1秒发送信号，指定当前线程执行</div><div class="line">[[RACSignal interval:1 onScheduler:[RACScheduler currentScheduler]] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;定时:%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">// 输出</div><div class="line">2017-01-04 13:48:55.196 ReactiveCocoa进阶[1980:492724] 定时:2017-01-04 05:48:55 +0000</div><div class="line">2017-01-04 13:48:56.195 ReactiveCocoa进阶[1980:492724] 定时:2017-01-04 05:48:56 +0000</div><div class="line">2017-01-04 13:48:57.196 ReactiveCocoa进阶[1980:492724] 定时:2017-01-04 05:48:57 +0000</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="timeout-超时"><a href="#timeout-超时" class="headerlink" title="timeout 超时"></a>timeout 超时</h6><ul>
<li><p><strong>作用</strong></p>
<p>  超时，可以让一个信号在一定的时间后，自动报错。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       // 不发送信号，模拟超时状态</div><div class="line">       // [subscriber sendNext:@&quot;hello&quot;];</div><div class="line">       //[subscriber sendCompleted];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;] timeout:1 onScheduler:[RACScheduler currentScheduler]];// 设置1秒超时</div><div class="line">   </div><div class="line">   [signal subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125; error:^(NSError *error) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, error);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   // 执行代码 1秒后 输出：</div><div class="line">   2017-01-04 13:48:55.195 ReactiveCocoa进阶[1980:492724] Error Domain=RACSignalErrorDomain Code=1 &quot;(null)&quot;</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="delay-延时"><a href="#delay-延时" class="headerlink" title="delay 延时"></a>delay 延时</h6><ul>
<li><p><strong>作用</strong></p>
<p>  延时，延迟一段时间后发送信号</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">RACSignal *signal2 = [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">       </div><div class="line">       [subscriber sendNext:@&quot;延迟输出&quot;];</div><div class="line">       </div><div class="line">       return nil;</div><div class="line">   &#125;] delay:2] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   // 执行代码 2秒后 输出</div><div class="line">   2017-01-04 13:55:23.751 ReactiveCocoa进阶[2030:525038] 延迟输出</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h4><h6 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h6><ul>
<li><p><strong>作用</strong></p>
<p>  重试：只要 发送错误 <code>sendError:</code>,就会 重新执行 创建信号的Block 直到成功</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">	__block int i = 0;</div><div class="line">    </div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        </div><div class="line">        if (i == 5) &#123;</div><div class="line">            </div><div class="line">            [subscriber sendNext:@&quot;Hello&quot;];</div><div class="line">            </div><div class="line">        &#125; else &#123;</div><div class="line">            </div><div class="line">            // 发送错误</div><div class="line">            NSLog(@&quot;收到错误:%d&quot;, i);</div><div class="line">            [subscriber sendError:nil];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        i++;</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">        </div><div class="line">    &#125;] retry] subscribeNext:^(id x) &#123;</div><div class="line">        </div><div class="line">        NSLog(@&quot;%@&quot;, x);</div><div class="line">        </div><div class="line">    &#125; error:^(NSError *error) &#123;</div><div class="line">        </div><div class="line">        NSLog(@&quot;%@&quot;, error);</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line"></div><div class="line">	// 输出</div><div class="line">2017-01-04 14:36:51.594 ReactiveCocoa进阶[2443:667226] 收到错误信息:0</div><div class="line">2017-01-04 14:36:51.595 ReactiveCocoa进阶[2443:667226] 收到错误信息:1</div><div class="line">2017-01-04 14:36:51.595 ReactiveCocoa进阶[2443:667226] 收到错误信息:2</div><div class="line">2017-01-04 14:36:51.596 ReactiveCocoa进阶[2443:667226] 收到错误信息:3</div><div class="line">2017-01-04 14:36:51.596 ReactiveCocoa进阶[2443:667226] 收到错误信息:4</div><div class="line">2017-01-04 14:36:51.596 ReactiveCocoa进阶[2443:667226] Hello</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="replay"><a href="#replay" class="headerlink" title="replay"></a>replay</h6><ul>
<li><p><strong>作用</strong></p>
<p>  重放：当一个信号被多次订阅,反复播放内容</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">	RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        </div><div class="line">        [subscriber sendNext:@1];</div><div class="line">        [subscriber sendNext:@2];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;] replay];</div><div class="line">    </div><div class="line">    [signal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;, x);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [signal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;, x);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    // 输出</div><div class="line">2017-01-04 14:51:01.934 ReactiveCocoa进阶[2544:706740] 1</div><div class="line">2017-01-04 14:51:01.934 ReactiveCocoa进阶[2544:706740] 2</div><div class="line">2017-01-04 14:51:01.934 ReactiveCocoa进阶[2544:706740] 1</div><div class="line">2017-01-04 14:51:01.935 ReactiveCocoa进阶[2544:706740] 2</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="throttle"><a href="#throttle" class="headerlink" title="throttle"></a>throttle</h6><ul>
<li><p><strong>作用</strong></p>
<p>  节流:当某个信号发送比较频繁时，可以使用节流，在某一段时间不发送信号内容，过了一段时间获取信号的最新内容发出。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">RACSubject *subject = [RACSubject subject];</div><div class="line">   </div><div class="line">   // 节流1秒，1秒后接收最后一个发送的信号</div><div class="line">   [[subject throttle:1] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">       NSLog(@&quot;%@&quot;, x);</div><div class="line">   &#125;];</div><div class="line">   </div><div class="line">   [subject sendNext:@1];</div><div class="line">   [subject sendNext:@2];</div><div class="line">   [subject sendNext:@3];</div><div class="line">   </div><div class="line">   // 输出</div><div class="line">   2017-01-04 15:02:37.543 ReactiveCocoa进阶[2731:758193] 3</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="MVVM架构思想"><a href="#MVVM架构思想" class="headerlink" title="MVVM架构思想"></a>MVVM架构思想</h1><hr>
<p>程序为什么要有架构？便于程序开发与维护.</p>
<h4 id="常见的架构"><a href="#常见的架构" class="headerlink" title="常见的架构"></a>常见的架构</h4><ul>
<li><p><strong>MVC</strong></p>
<p>  M:模型 V:视图 C:控制器</p>
</li>
<li><p><strong>MVVM</strong></p>
<p>  M:模型 V:视图+控制器 VM:视图模型</p>
</li>
<li><p><strong>MVCS</strong></p>
<p>   M:模型 V:视图 C:控制器 C:服务类</p>
</li>
<li><p><a href="http://www.cocoachina.com/ios/20140703/9016.html" target="_blank" rel="external"><strong>VIPER</strong></a></p>
<p>  V:视图 I:交互器 P:展示器 E:实体 R:路由</p>
</li>
</ul>
<h4 id="MVVM介绍"><a href="#MVVM介绍" class="headerlink" title="MVVM介绍"></a>MVVM介绍</h4><ul>
<li><p>模型(M):保存视图数据。</p>
</li>
<li><p>视图+控制器(V):展示内容 + 如何展示</p>
</li>
<li><p>视图模型(VM):处理展示的业务逻辑，包括按钮的点击，数据的请求和解析等等。</p>
</li>
</ul>
<h1 id="实战一：登录界面"><a href="#实战一：登录界面" class="headerlink" title="实战一：登录界面"></a>实战一：登录界面</h1><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><ol>
<li>监听两个文本框的内容</li>
<li>有内容登录按键才允许按钮点击</li>
<li>返回登录结果</li>
</ol>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ol>
<li>界面的所有业务逻辑都交给控制器做处理</li>
<li>在MVVM架构中把控制器的业务全部搬去VM模型，也就是每个控制器对应一个VM模型.</li>
</ol>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>创建LoginViewModel类，处理登录界面业务逻辑.</li>
<li>这个类里面应该保存着账号的信息，创建一个账号Account模型</li>
<li>LoginViewModel应该保存着账号信息Account模型。</li>
<li>需要时刻监听Account模型中的账号和密码的改变，怎么监听？</li>
<li>在非RAC开发中，都是习惯赋值，在RAC开发中，需要改变开发思维，由赋值转变为绑定，可以在一开始初始化的时候，就给Account模型中的属性绑定，并不需要重写set方法。</li>
<li>每次Account模型的值改变，就需要判断按钮能否点击，在VM模型中做处理，给外界提供一个能否点击按钮的信号.</li>
<li>这个登录信号需要判断Account中账号和密码是否有值，用KVO监听这两个值的改变，把他们聚合成登录信号.</li>
<li>监听按钮的点击，由VM处理，应该给VM声明一个RACCommand，专门处理登录业务逻辑.</li>
<li>执行命令，把数据包装成信号传递出去</li>
<li>监听命令中信号的数据传递</li>
<li>监听命令的执行时刻</li>
</ol>
<h4 id="运行效果"><a href="#运行效果" class="headerlink" title="运行效果"></a>运行效果</h4><p><img src="https://ww3.sinaimg.cn/large/006y8lVagw1fbgvoh8yu6j30bj0l43yz.jpg" alt="登录界面"></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p><code>MyViewController.m</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">#import &quot;MyViewController.h&quot;</div><div class="line">#import &quot;LoginViewModel.h&quot;</div><div class="line"></div><div class="line">@interface MyViewController ()</div><div class="line"></div><div class="line">@property (nonatomic, strong) LoginViewModel *loginViewModel;</div><div class="line"></div><div class="line">@property (weak, nonatomic) IBOutlet UITextField *accountField;</div><div class="line"></div><div class="line">@property (weak, nonatomic) IBOutlet UITextField *pwdField;</div><div class="line"></div><div class="line">@property (weak, nonatomic) IBOutlet UIButton *loginBtn;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation MyViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    [self bindModel];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)didReceiveMemoryWarning &#123;</div><div class="line">    [super didReceiveMemoryWarning];</div><div class="line">    // Dispose of any resources that can be recreated.</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">// 视图模型绑定</div><div class="line">- (void)bindModel &#123;</div><div class="line"></div><div class="line">    // 给模型的属性绑定信号</div><div class="line">    //</div><div class="line">    RAC(self.loginViewModel.account, account) = _accountField.rac_textSignal;</div><div class="line">    RAC(self.loginViewModel.account, pwd) = _pwdField.rac_textSignal;</div><div class="line">    </div><div class="line">    RAC(self.loginBtn, enabled) = self.loginViewModel.enableLoginSignal;</div><div class="line">    </div><div class="line">    // 监听登录点击</div><div class="line">    [[_loginBtn rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) &#123;</div><div class="line">        </div><div class="line">        [self.loginViewModel.LoginCommand execute:nil];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">&#125;</div><div class="line">- (IBAction)btnTap:(id)sender &#123;</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - lazyLoad</div><div class="line"></div><div class="line">- (LoginViewModel *)loginViewModel &#123;</div><div class="line">    </div><div class="line">    if (nil == _loginViewModel) &#123;</div><div class="line">        _loginViewModel = [[LoginViewModel alloc] init];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return _loginViewModel;</div><div class="line">&#125;</div><div class="line">```	</div><div class="line">		</div><div class="line">`LoginViewModel.h`</div></pre></td></tr></table></figure>
<p>#import <uikit uikit.h=""></uikit></p>
<p>@interface Account : NSObject</p>
<p>@property (nonatomic, strong) NSString <em>account;<br>@property (nonatomic, strong) NSString </em>pwd;</p>
<p>@end</p>
<p>@interface LoginViewModel : UIViewController</p>
<p>@property (nonatomic, strong) Account *account;</p>
<p>// 是否允许登录的信号<br>@property (nonatomic, strong, readonly) RACSignal *enableLoginSignal;</p>
<p>@property (nonatomic, strong, readonly) RACCommand *LoginCommand;</p>
<p>@end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">`LoginViewModel.m`</div></pre></td></tr></table></figure>
<p>#import “LoginViewModel.h”</p>
<p>@implementation Account</p>
<p>@end</p>
<p>@interface LoginViewModel ()</p>
<p>@end</p>
<p>@implementation LoginViewModel</p>
<ul>
<li><p>(instancetype)init {</p>
<p>  if (self = [super init]) {</p>
<pre><code>[self initialBind];
</code></pre><p>  }<br>  return self;<br>}</p>
</li>
<li><p>(void)initialBind {</p>
<p>  // 监听账号属性改变， 把他们合成一个信号<br>  _enableLoginSignal = [RACSubject combineLatest:@[RACObserve(self.account, account), RACObserve(self.account, pwd)] reduce:^id(NSString <em>accout, NSString </em>pwd){</p>
<pre><code>return @(accout.length &amp;&amp; pwd.length);
</code></pre><p>  }];</p>
<p>  // 处理业务逻辑<br>  _LoginCommand = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) {</p>
<pre><code>NSLog(@&quot;点击了登录&quot;);
return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) {

    // 模仿网络延迟

    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{

        // 返回登录成功 发送成功信号
        [subscriber sendNext:@&quot;登录成功&quot;];
    });

    return nil;
}];
</code></pre><p>  }];</p>
</li>
</ul>
<pre><code>// 监听登录产生的数据
[_LoginCommand.executionSignals.switchToLatest subscribeNext:^(id x) {

    if ([x isEqualToString:@&quot;登录成功&quot;]) {
        NSLog(@&quot;登录成功&quot;);
    }

}];

[[_LoginCommand.executing skip:1] subscribeNext:^(id x) {

    if ([x isEqualToNumber:@(YES)]) {

        NSLog(@&quot;正在登陆...&quot;);
    } else {

    // 登录成功
    NSLog(@&quot;登陆成功&quot;);

    }

}];
</code></pre><p>}</p>
<p>#pragma mark - lazyLoad</p>
<ul>
<li><p>(Account *)account<br>{<br>  if (_account == nil) {</p>
<pre><code>_account = [[Account alloc] init];
</code></pre><p>  }<br>  return _account;<br>}</p>
</li>
<li><p>(void)viewDidLoad {<br>  [super viewDidLoad];</p>
</li>
</ul>
<p>}</p>
<p>@end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># 实战二：网络请求数据</div><div class="line"></div><div class="line">#### 需求</div><div class="line">1. 请求一段网络数据，将请求到的数据在`tableView`上展示</div><div class="line">2. 该数据为豆瓣图书的搜索返回结果，URL：url:https://api.douban.com/v2/book/search?q=悟空传</div><div class="line"></div><div class="line">#### 分析</div><div class="line">1. 界面的所有业务逻辑都交给**控制器**做处理</div><div class="line">2. 网络请求交给**MV**模型处理</div><div class="line"></div><div class="line">#### 步骤</div><div class="line"></div><div class="line">1. 控制器提供一个视图模型（requesViewModel），处理界面的业务逻辑</div><div class="line">2. VM提供一个命令，处理请求业务逻辑</div><div class="line">3. 在创建命令的block中，会把请求包装成一个信号，等请求成功的时候，就会把数据传递出去。</div><div class="line">4. 请求数据成功，应该把字典转换成模型，保存到视图模型中，控制器想用就直接从视图模型中获取。</div><div class="line"></div><div class="line">#### 其他</div><div class="line"></div><div class="line">网络请求与图片缓存用到了[AFNetworking](https://github.com/AFNetworking/AFNetworking) 和 [SDWebImage](https://github.com/rs/SDWebImage),自行在Pods中导入。</div></pre></td></tr></table></figure>
<p>platform :ios, ‘8.0’</p>
<p>target ‘ReactiveCocoa进阶’ do</p>
<p>use_frameworks!<br>pod ‘ReactiveCocoa’, ‘~&gt; 2.5’<br>pod ‘AFNetworking’<br>pod ‘SDWebImage’<br>end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 运行效果</div><div class="line"></div><div class="line">![](https://ww3.sinaimg.cn/large/006y8lVagw1fbgw1xnz74j30bj0l4408.jpg)</div><div class="line"></div><div class="line"></div><div class="line">#### 代码</div><div class="line"></div><div class="line">`SearchViewController.m`</div></pre></td></tr></table></figure></p>
<p>#import “SearchViewController.h”</p>
<p>#import “RequestViewModel.h”</p>
<p>@interface SearchViewController ()<uitableviewdatasource></uitableviewdatasource></p>
<p>@property (nonatomic, strong) UITableView *tableView;</p>
<p>@property (nonatomic, strong) RequestViewModel *requesViewModel;</p>
<p>@end</p>
<p>@implementation SearchViewController</p>
<ul>
<li><p>(RequestViewModel *)requesViewModel<br>{<br>  if (_requesViewModel == nil) {</p>
<pre><code>_requesViewModel = [[RequestViewModel alloc] init];
</code></pre><p>  }<br>  return _requesViewModel;<br>}</p>
</li>
<li><p>(void)viewDidLoad {<br>  [super viewDidLoad];</p>
</li>
</ul>
<pre><code>self.tableView = [[UITableView alloc] initWithFrame:self.view.frame];

self.tableView.dataSource = self;

[self.view addSubview:self.tableView];

//
RACSignal *requesSiganl = [self.requesViewModel.reuqesCommand execute:nil];

[requesSiganl subscribeNext:^(NSArray *x) {

    self.requesViewModel.models = x;

    [self.tableView reloadData];
}];
</code></pre><p>}</p>
<ul>
<li><p>(void)didReceiveMemoryWarning {<br>  [super didReceiveMemoryWarning];<br>  // Dispose of any resources that can be recreated.<br>}</p>
</li>
<li><p>(NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section<br>{<br>  return self.requesViewModel.models.count;<br>}</p>
</li>
<li><p>(UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath <em>)indexPath<br>{<br>  static NSString </em>ID = @”cell”;<br>  UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:ID];<br>  if (cell == nil) {</p>
<pre><code>cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:ID];
</code></pre><p>  }</p>
<p>  Book *book = self.requesViewModel.models[indexPath.row];<br>  cell.detailTextLabel.text = book.subtitle;<br>  cell.textLabel.text = book.title;</p>
<p>  [cell.imageView sd_setImageWithURL:[NSURL URLWithString:book.image] placeholderImage:[UIImage imageNamed:@”cellImage”]];</p>
</li>
</ul>
<pre><code>return cell;
</code></pre><p>}<br>@end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">`RequestViewModel.h`</div></pre></td></tr></table></figure></p>
<p>#import <foundation foundation.h=""></foundation></p>
<p>@interface Book : NSObject</p>
<p>@property (nonatomic, copy) NSString <em>subtitle;<br>@property (nonatomic, copy) NSString </em>title;<br>@property (nonatomic, copy) NSString *image;</p>
<p>@end</p>
<p>@interface RequestViewModel : NSObject</p>
<p>// 请求命令<br>@property (nonatomic, strong, readonly) RACCommand *reuqesCommand;</p>
<p>//模型数组<br>@property (nonatomic, strong) NSArray *models;</p>
<p>@end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">`RequestViewModel.m`</div></pre></td></tr></table></figure></p>
<p>#import “RequestViewModel.h”</p>
<p>@implementation Book</p>
<ul>
<li><p>(instancetype)initWithValue:(NSDictionary *)value {</p>
<p>  if (self = [super init]) {</p>
<pre><code>self.title = value[@&quot;title&quot;];
self.subtitle = value[@&quot;subtitle&quot;];
self.image = value[@&quot;image&quot;];
</code></pre><p>  }<br>  return self;<br>}</p>
</li>
</ul>
<ul>
<li><p>(Book <em>)bookWithDict:(NSDictionary </em>)value {</p>
<p>  return [[self alloc] initWithValue:value];<br>}</p>
</li>
</ul>
<p>@end</p>
<p>@implementation RequestViewModel</p>
<ul>
<li><p>(instancetype)init<br>{<br>  if (self = [super init]) {</p>
<pre><code>[self initialBind];
</code></pre><p>  }<br>  return self;<br>}</p>
</li>
</ul>
<ul>
<li><p>(void)initialBind<br>{<br>  _reuqesCommand = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) {</p>
<pre><code>RACSignal *requestSiganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) {

    NSMutableDictionary *parameters = [NSMutableDictionary dictionary];
    parameters[@&quot;q&quot;] = @&quot;悟空传&quot;;

    //
    [[AFHTTPSessionManager manager] GET:@&quot;https://api.douban.com/v2/book/search&quot; parameters:parameters progress:^(NSProgress * _Nonnull downloadProgress) {

        NSLog(@&quot;downloadProgress: %@&quot;, downloadProgress);
    } success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {

        // 数据请求成功就讲数据发送出去
        NSLog(@&quot;responseObject:%@&quot;, responseObject);

        [subscriber sendNext:responseObject];

        [subscriber sendCompleted];

    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {

        NSLog(@&quot;error: %@&quot;, error);
    }];
</code></pre></li>
</ul>
<pre><code>     return nil;
  }];

    // 在返回数据信号时，把数据中的字典映射成模型信号，传递出去
    return [requestSiganl map:^id(NSDictionary *value) {

        NSMutableArray *dictArr = value[@&quot;books&quot;];

        NSArray *modelArr = [[dictArr.rac_sequence map:^id(id value) {

            return [Book bookWithDict:value];

        }] array];

        return modelArr;

    }];

}];
</code></pre><p>}</p>
<p>@end</p>
<p>```</p>
<blockquote>
<p>最后附上GitHub：<a href="https://github.com/qiubaiying/ReactiveCocoa_Demo" target="_blank" rel="external">https://github.com/qiubaiying/ReactiveCocoa_Demo</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/2016-12-26-ReactiveCocoa-基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/26/2016-12-26-ReactiveCocoa-基础/" itemprop="url">ReactiveCocoa 基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-26T00:00:00+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ReactiveCocoa基础"><a href="#ReactiveCocoa基础" class="headerlink" title="ReactiveCocoa基础"></a>ReactiveCocoa基础</h1><blockquote>
<p>本文修改自<a href="http://www.jianshu.com/p/87ef6720a096" target="_blank" rel="external">最快让你上手ReactiveCocoa之基础篇</a></p>
<p>有关对 <strong>ReactiveCocoa</strong> 的看法可以看一下唐巧的这篇<a href="https://gold.xitu.io/entry/568bd2ae60b2e57ba2cd2c7b" target="_blank" rel="external">ReactiveCocoa 讨论会</a></p>
</blockquote>
<p><img src="http://ww2.sinaimg.cn/large/006y8lVagw1fb7g0gukk8j30m90rl78j.jpg" alt="ReactiveCocoa思维导图"></p>
<h1 id="ReactiveCocoa简介"><a href="#ReactiveCocoa简介" class="headerlink" title="ReactiveCocoa简介"></a>ReactiveCocoa简介</h1><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/large/006y8lVagw1fb7g6on3iwj30c2029q2z.jpg" alt=""></a></p>
<p>ReactiveCocoa（简称为RAC）,是由Github开源的一个应用于iOS和OS开发的新框架,Cocoa是苹果整套框架的简称，因此很多苹果框架喜欢以Cocoa结尾。</p>
<p>在我们iOS开发过程中，当某些事件响应的时候，需要处理某些业务逻辑,这些事件都用不同的方式来处理。</p>
<p>比如按钮的点击使用action，ScrollView滚动使用delegate，属性值改变使用KVO等系统提供的方式。其实这些事件，都可以通过RAC处理</p>
<p>ReactiveCocoa为事件提供了很多处理方法，而且利用RAC处理事件很方便，可以把要处理的事情，和监听的事情的代码放在一起，这样非常方便我们管理，就不需要跳到对应的方法里。</p>
<p>非常符合我们开发中高聚合，低耦合的思想。</p>
<h1 id="ReactiveCocoa编程思想"><a href="#ReactiveCocoa编程思想" class="headerlink" title="ReactiveCocoa编程思想"></a>ReactiveCocoa编程思想</h1><p>在开发中我们也不能太依赖于某个框架，否则这个框架不更新了，导致项目后期没办法维护，比如之前Facebook提供的 <code>Three20</code> 框架，在当时也是神器，但是后来不更新了，也就没什么人用了。因此我感觉学习一个框架，还是有必要了解它的编程思想。</p>
<p>先简单介绍下目前咱们已知的编程思想:</p>
<h4 id="响应式编程思想"><a href="#响应式编程思想" class="headerlink" title="响应式编程思想"></a>响应式编程思想</h4><p><strong>响应式编程思想</strong>：不需要考虑调用顺序，只需要知道考虑结果，类似于蝴蝶效应，产生一个事件，会影响很多东西，这些事件像流一样的传播出去，然后影响结果，借用面向对象的一句话，万物皆是流。</p>
<p><code>代表</code>：KVO</p>
<h4 id="链式编程思想"><a href="#链式编程思想" class="headerlink" title="链式编程思想"></a>链式编程思想</h4><p><strong>链式编程</strong> 是将多个操作（多行代码）通过点号(.)链接在一起成为一句代码,使代码可读性好。如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make.add(1).add(2).sub(5).muilt(-4).divide(4);</div></pre></td></tr></table></figure>
<p><code>特点</code>：方法的返回值是block,block必须有返回值（本身对象），block参数（需要操作的值）</p>
<p><code>代表</code>：masonry框架。</p>
<p><code>实现</code>：模仿masonry，写一个加法计算器，练习链式编程思想。</p>
<p>NSObject+Caculator.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@class CaculatorMaker;</div><div class="line"></div><div class="line">@interface NSObject (Caculator)</div><div class="line"></div><div class="line">// 计算</div><div class="line">+ (int)makeCaculators:(void (^)(CaculatorMaker *))block;</div><div class="line">                       </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>NSObject+Caculator.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@implementation NSObject (Caculator)</div><div class="line"></div><div class="line">+ (int)makeCaculators:(void (^)(CaculatorMaker *))block &#123;</div><div class="line">    </div><div class="line">    CaculatorMaker *mgr = [[CaculatorMaker alloc] init];</div><div class="line">    </div><div class="line">    block(mgr);</div><div class="line">    </div><div class="line">    return (mgr.result);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>CaculatorMaker.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@class CaculatorMaker;</div><div class="line"></div><div class="line">typedef CaculatorMaker *(^CasulatorBlock)(int);</div><div class="line"></div><div class="line">@interface CaculatorMaker : NSObject</div><div class="line"></div><div class="line">@property (nonatomic, assign) int result;</div><div class="line"></div><div class="line">// 算数方法</div><div class="line">- (CaculatorMaker *(^)(int))add;</div><div class="line">- (CasulatorBlock)sub;</div><div class="line">- (CasulatorBlock)muilt;</div><div class="line">- (CasulatorBlock)divide;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>CaculatorMaker.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"># import &quot;CaculatorMaker.h&quot;</div><div class="line"></div><div class="line">@implementation CaculatorMaker</div><div class="line"></div><div class="line">- (CaculatorMaker *(^)(int))add &#123;</div><div class="line"></div><div class="line">    return ^CaculatorMaker *(int value) &#123;</div><div class="line">        </div><div class="line">        _result += value;</div><div class="line">        </div><div class="line">        return self;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CasulatorBlock)sub &#123;</div><div class="line">    </div><div class="line">    return ^CaculatorMaker *(int value) &#123;</div><div class="line">        </div><div class="line">        _result -= value;</div><div class="line">        </div><div class="line">        return self;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CasulatorBlock)muilt &#123;</div><div class="line"></div><div class="line">    return ^CaculatorMaker *(int value) &#123;</div><div class="line">        </div><div class="line">        _result *= value;</div><div class="line">        </div><div class="line">        return self;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CasulatorBlock)divide &#123;</div><div class="line">    </div><div class="line">    return ^CaculatorMaker *(int value) &#123;</div><div class="line">        </div><div class="line">        _result /= value;</div><div class="line">        </div><div class="line">        return self;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">int result = [NSObject makeCaculators:^(CaculatorMaker *make) &#123;</div><div class="line">        </div><div class="line">        // ( 1 + 2 - 5 ) * (-4) / 4</div><div class="line">        make.add(1).add(2).sub(5).muilt(-4).divide(4);</div><div class="line"></div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    NSLog(@&quot;%d&quot;, result);</div></pre></td></tr></table></figure>
<h4 id="函数式编程思想"><a href="#函数式编程思想" class="headerlink" title="函数式编程思想"></a>函数式编程思想</h4><p><strong>函数式编程思想</strong>：是把操作尽量写成一系列嵌套的函数或者方法调用。</p>
<p><code>特点</code>：每个方法必须有返回值（本身对象）,把函数或者Block当做参数,block参数（需要操作的值）block返回值（操作结果）</p>
<p><code>代表</code>：<strong>ReactiveCocoa</strong></p>
<p><code>实现</code>：用函数式编程实现，写一个加法计算器,并且加法计算器自带判断是否等于某个值.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Calculator *caculator = [[Calculator alloc] init];</div><div class="line"></div><div class="line">BOOL isqule = [[[caculator caculator:^int(int result) &#123;</div><div class="line">    </div><div class="line">    result += 2;</div><div class="line">    result *= 5;</div><div class="line">    return result;</div><div class="line">    </div><div class="line">&#125;] equle:^BOOL(int result) &#123;</div><div class="line">    </div><div class="line">    return result == 10;</div><div class="line">    </div><div class="line">&#125;] isEqule];</div><div class="line"></div><div class="line">NSLog(@&quot;%d&quot;, isqule);</div></pre></td></tr></table></figure>
<p>Calculator.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface Calculator : NSObject</div><div class="line"></div><div class="line">@property (nonatomic, assign) BOOL isEqule;</div><div class="line"></div><div class="line">@property (nonatomic, assign) int result;</div><div class="line"></div><div class="line">- (Calculator *)caculator:(int (^)(int result))caculator;</div><div class="line"></div><div class="line">- (Calculator *)equle:(BOOL (^)(int result))operation;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>Calculator.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#import &quot;Calculator.h&quot;</div><div class="line"></div><div class="line">@implementation Calculator</div><div class="line"></div><div class="line">- (Calculator *)caculator:(int (^)(int))caculator &#123;</div><div class="line"></div><div class="line">    _result = caculator(_result);</div><div class="line">    </div><div class="line">    return self;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (Calculator *)equle:(BOOL (^)(int))operation &#123;</div><div class="line"></div><div class="line">    _isEqule = operation(_result);</div><div class="line">    </div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p><strong>ReactiveCocoa</strong> 结合了这两种种编程风格：</p>
<ul>
<li><p><strong>函数式编程</strong>（Functional Programming）</p>
</li>
<li><p><strong>响应式编程</strong>（Reactive Programming）</p>
</li>
</ul>
<p>所以，你可能听说过 <strong>ReactiveCocoa</strong> 被描述为函数响应式编程（FRP）框架。</p>
<p>以后使用RAC解决问题，就不需要考虑调用顺序，直接考虑结果，把每一次操作都写成一系列嵌套的方法中，使代码高聚合，方便管理。</p>
<h1 id="导入ReactiveCocoa"><a href="#导入ReactiveCocoa" class="headerlink" title="导入ReactiveCocoa"></a>导入ReactiveCocoa</h1><hr>
<blockquote>
<p>ReactiveCocoa的<a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">GitHub地址</a></p>
</blockquote>
<h4 id="Objective-C"><a href="#Objective-C" class="headerlink" title="Objective-C"></a>Objective-C</h4><p><strong>ReactiveCocoa 2.5</strong>版本以后改用了<strong>Swift</strong>，所以<strong>Objective-C</strong>项目需要导入<strong>2.5版本</strong></p>
<p><code>CocoaPods</code>集成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">platform :ios, &apos;8.0&apos;</div><div class="line"></div><div class="line">target &apos;YouProjectName&apos; do</div><div class="line"></div><div class="line">use_frameworks!</div><div class="line">pod &apos;ReactiveCocoa&apos;, &apos;~&gt; 2.5&apos;</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>PS:新版本的<code>CocoaPods</code>需要加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">target &apos;YouProjectName&apos; do </div><div class="line">... </div><div class="line">end</div></pre></td></tr></table></figure>
<p>这句话来限定项目，否则导入失败。</p>
<h4 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h4><p><strong>Swift</strong>项目导入2.5后的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">platform :ios, &apos;8.0&apos;</div><div class="line"></div><div class="line">target &apos;YouProjectName&apos; do</div><div class="line"></div><div class="line">use_frameworks!</div><div class="line">pod &apos;ReactiveCocoa&apos;</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>使用时在<a href="http://www.jianshu.com/p/587b83b6665c" target="_blank" rel="external">全局头文件</a>导入头文件即可</p>
<p><code>PrefixHeader.pch</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#ifndef PrefixHeader_pch</div><div class="line">#define PrefixHeader_pch</div><div class="line"></div><div class="line">#import &lt;ReactiveCocoa/ReactiveCocoa.h&gt;</div><div class="line"></div><div class="line">#endif</div></pre></td></tr></table></figure>
<h1 id="ReactiveCocoa常见类"><a href="#ReactiveCocoa常见类" class="headerlink" title="ReactiveCocoa常见类"></a>ReactiveCocoa常见类</h1><h4 id="RACSiganl-信号类"><a href="#RACSiganl-信号类" class="headerlink" title="RACSiganl 信号类"></a>RACSiganl 信号类</h4><blockquote>
<p>信号类,一般表示将来有数据传递，只要有数据改变，信号内部接收到数据，就会马上发出数据。</p>
</blockquote>
<p>注意：</p>
<ul>
<li>信号类(RACSiganl)，只是表示当数据改变时，信号内部会发出数据，它本身不具备发送信号的能力，而是交给内部一个订阅者去发出。</li>
<li>默认一个信号都是冷信号，也就是值改变了，也不会触发，只有订阅了这个信号，这个信号才会变为热信号，值改变了才会触发。</li>
<li>如何订阅信号：调用信号RACSignal的subscribeNext就能订阅</li>
</ul>
<p>使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">// RACSignal使用步骤：</div><div class="line">    // 1.创建信号 + (RACSignal *)createSignal:(RACDisposable * (^)(id&lt;RACSubscriber&gt; subscriber))didSubscribe</div><div class="line">    // 2.订阅信号,才会激活信号. - (RACDisposable *)subscribeNext:(void (^)(id x))nextBlock</div><div class="line">    // 3.发送信号 - (void)sendNext:(id)value</div><div class="line"></div><div class="line"></div><div class="line">    // RACSignal底层实现：</div><div class="line">    // 1.创建信号，首先把didSubscribe保存到信号中，还不会触发。</div><div class="line">    // 2.当信号被订阅，也就是调用signal的subscribeNext:nextBlock</div><div class="line">    // 2.2 subscribeNext内部会创建订阅者subscriber，并且把nextBlock保存到subscriber中。</div><div class="line">    // 2.1 subscribeNext内部会调用siganl的didSubscribe</div><div class="line">    // 3.siganl的didSubscribe中调用[subscriber sendNext:@1];</div><div class="line">    // 3.1 sendNext底层其实就是执行subscriber的nextBlock</div><div class="line"></div><div class="line">    // 1.创建信号</div><div class="line">    RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line"></div><div class="line">        // block调用时刻：每当有订阅者订阅信号，就会调用block。</div><div class="line"></div><div class="line">        // 2.发送信号</div><div class="line">        [subscriber sendNext:@1];</div><div class="line"></div><div class="line">        // 如果不在发送数据，最好发送信号完成，内部会自动调用[RACDisposable disposable]取消订阅信号。</div><div class="line">        [subscriber sendCompleted];</div><div class="line"></div><div class="line">        return [RACDisposable disposableWithBlock:^&#123;</div><div class="line"></div><div class="line">            // block调用时刻：当信号发送完成或者发送错误，就会自动执行这个block,取消订阅信号。</div><div class="line"></div><div class="line">            // 执行完Block后，当前信号就不在被订阅了。</div><div class="line"></div><div class="line">            NSLog(@&quot;信号被销毁&quot;);</div><div class="line"></div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    // 3.订阅信号,才会激活信号.</div><div class="line">    [siganl subscribeNext:^(id x) &#123;</div><div class="line">        // block调用时刻：每当有信号发出数据，就会调用block.</div><div class="line">        NSLog(@&quot;接收到数据:%@&quot;,x);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<h4 id="RACSubscriber"><a href="#RACSubscriber" class="headerlink" title="RACSubscriber"></a>RACSubscriber</h4><blockquote>
<p>表示订阅者的意思，用于发送信号，这是一个协议，不是一个类，只要遵守这个协议，并且实现方法才能成为订阅者。通过create创建的信号，都有一个订阅者，帮助他发送数据。</p>
</blockquote>
<h4 id="RACDisposable"><a href="#RACDisposable" class="headerlink" title="RACDisposable"></a>RACDisposable</h4><blockquote>
<p>用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。</p>
</blockquote>
<p><strong>使用场景</strong>：不想监听某个信号时，可以通过它主动取消订阅信号。</p>
<h4 id="RACSubject"><a href="#RACSubject" class="headerlink" title="RACSubject"></a>RACSubject</h4><blockquote>
<p>RACSubject:信号提供者，自己可以充当信号，又能发送信号。</p>
</blockquote>
<p><strong>使用场景</strong>:通常用来代替代理，有了它，就不必要定义代理了。</p>
<h4 id="RACReplaySubject"><a href="#RACReplaySubject" class="headerlink" title="RACReplaySubject"></a><strong>RACReplaySubject</strong></h4><blockquote>
<p>重复提供信号类，RACSubject的子类。</p>
</blockquote>
<p><code>RACReplaySubject</code>与<code>RACSubject</code>区别:</p>
<p> <code>RACReplaySubject</code>可以先发送信号，在订阅信号，<code>RACSubject</code>就不可以。</p>
<p> <strong>使用场景一</strong>:如果一个信号每被订阅一次，就需要把之前的值重复发送一遍，使用重复提供信号类。</p>
<p> <strong>使用场景二</strong>:可以设置capacity数量来限制缓存的value的数量,即只缓充最新的几个值。</p>
<p> <strong>ACSubject</strong> 和 <strong>RACReplaySubject</strong> 简单使用：</p>
<p> <strong>ACSubject</strong></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"> // RACSubject使用步骤</div><div class="line">// 1.创建信号 [RACSubject subject]，跟RACSiganl不一样，创建信号时没有block。</div><div class="line">// 2.订阅信号 - (RACDisposable *)subscribeNext:(void (^)(id x))nextBlock</div><div class="line">// 3.发送信号 sendNext:(id)value</div><div class="line"></div><div class="line">// RACSubject:底层实现和RACSignal不一样。</div><div class="line">// 1.调用subscribeNext订阅信号，只是把订阅者保存起来，并且订阅者的nextBlock已经赋值了。</div><div class="line">// 2.调用sendNext发送信号，遍历刚刚保存的所有订阅者，一个一个调用订阅者的nextBlock。</div><div class="line"></div><div class="line"></div><div class="line">// 1. 创建信号</div><div class="line">RACSubject *subject = [RACSubject subject];</div><div class="line"></div><div class="line">// 2.订阅信号</div><div class="line">[subject subscribeNext:^(id x) &#123;</div><div class="line">   </div><div class="line">    // block调用时机：当信号发出新值，就会调用</div><div class="line">    NSLog(@&quot;收到信号&quot;);</div><div class="line">    </div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 3.发送信号</div><div class="line">NSLog(@&quot;发送信号&quot;);</div><div class="line">[subject sendNext:@&quot;1&quot;];</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"> // RACReplaySubject使用步骤:</div><div class="line">// 1.创建信号 [RACSubject subject]，跟RACSiganl不一样，创建信号时没有block。</div><div class="line">// 2.可以先订阅信号，也可以先发送信号。</div><div class="line">// 2.1 订阅信号 - (RACDisposable *)subscribeNext:(void (^)(id x))nextBlock</div><div class="line">// 2.2 发送信号 sendNext:(id)value</div><div class="line"></div><div class="line">// RACReplaySubject:底层实现和RACSubject不一样。</div><div class="line">// 1.调用sendNext发送信号，把值保存起来，然后遍历刚刚保存的所有订阅者，一个一个调用订阅者的nextBlock。</div><div class="line">// 2.调用subscribeNext订阅信号，遍历保存的所有值，一个一个调用订阅者的nextBlock</div><div class="line"></div><div class="line">// 如果想当一个信号被订阅，就重复播放之前所有值，需要先发送信号，在订阅信号。</div><div class="line">// 也就是先保存值，在订阅值。</div><div class="line"></div><div class="line"></div><div class="line">// 1.创建信号</div><div class="line">RACReplaySubject *replaySubject = [RACReplaySubject subject];</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">// 3.先订阅信号</div><div class="line">[replaySubject subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;第一个订阅者接受到的数据%@&quot;, x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 2.发送信号</div><div class="line">[replaySubject sendNext:@1];</div><div class="line">[replaySubject sendNext:@2];</div><div class="line"></div><div class="line">// 后订阅信号</div><div class="line">[replaySubject subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;第二个订阅者接收到的数据%@&quot;,x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p><strong>RACSubject</strong>替换代理（与block类似）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">// 需求:</div><div class="line">    // 1.给当前控制器添加一个按钮，modal到另一个控制器界面</div><div class="line">    // 2.另一个控制器view中有个按钮，点击按钮，通知当前控制器</div><div class="line"></div><div class="line">步骤一：在第二个控制器.h，添加一个RACSubject代替代理。</div><div class="line">@interface TwoViewController : UIViewController</div><div class="line"></div><div class="line">@property (nonatomic, strong) RACSubject *delegateSignal;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">步骤二：监听第二个控制器按钮点击</div><div class="line">@implementation TwoViewController</div><div class="line">- (IBAction)notice:(id)sender &#123;</div><div class="line">    // 通知第一个控制器，告诉它，按钮被点了</div><div class="line"></div><div class="line">     // 通知代理</div><div class="line">     // 判断代理信号是否有值</div><div class="line">    if (self.delegateSignal) &#123;</div><div class="line">        // 有值，才需要通知</div><div class="line">        [self.delegateSignal sendNext:nil];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">步骤三：在第一个控制器中，监听跳转按钮，给第二个控制器的代理信号赋值，并且监听.</div><div class="line">@implementation OneViewController </div><div class="line">- (IBAction)btnClick:(id)sender &#123;</div><div class="line"></div><div class="line">    // 创建第二个控制器</div><div class="line">    TwoViewController *twoVc = [[TwoViewController alloc] init];</div><div class="line"></div><div class="line">    // 设置代理信号</div><div class="line">    twoVc.delegateSignal = [RACSubject subject];</div><div class="line"></div><div class="line">    // 订阅代理信号</div><div class="line">    [twoVc.delegateSignal subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line">        NSLog(@&quot;点击了通知按钮 %@&quot;, x);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    // 跳转到第二个控制器</div><div class="line">    [self presentViewController:twoVc animated:YES completion:@&quot;hi&quot;];</div><div class="line"></div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="RACTuple"><a href="#RACTuple" class="headerlink" title="RACTuple"></a>RACTuple</h4><blockquote>
<p>元组类,类似NSArray,用来包装值.(<code>@[key, value]</code>)</p>
</blockquote>
<h4 id="RACSequence"><a href="#RACSequence" class="headerlink" title="RACSequence"></a>RACSequence</h4><blockquote>
<p>RAC中的集合类，用于代替NSArray,NSDictionary,可以使用它来快速遍历数组和字典。</p>
</blockquote>
<p>使用场景：字典转模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">// 1.遍历数组</div><div class="line">NSArray *numbers = @[@1,@2,@3,@4];</div><div class="line"></div><div class="line">// 这里其实是三步</div><div class="line">// 第一步: 把数组转换成集合RACSequence numbers.rac_sequence</div><div class="line">// 第二步: 把集合RACSequence转换RACSignal信号类,numbers.rac_sequence.signal</div><div class="line">// 第三步: 订阅信号，激活信号，会自动把集合中的所有值，遍历出来。</div><div class="line"></div><div class="line">[numbers.rac_sequence.signal subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;%@&quot;, x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">// 2.遍历字典,遍历出来的键值对 都会包装成 RACTuple(元组对象) @[key, value]</div><div class="line">NSDictionary *dic = @&#123;@&quot;name&quot;: @&quot;BYqiu&quot;, @&quot;age&quot;: @18&#125;;</div><div class="line"></div><div class="line">[dic.rac_sequence.signal subscribeNext:^(RACTuple *x) &#123;</div><div class="line">    </div><div class="line">    // 解元组包，会把元组的值，按顺序给参数里的变量赋值</div><div class="line">    // 写法相当与</div><div class="line">    // NSString *key = x[0];</div><div class="line">    // NSString *value = x[1];</div><div class="line">    RACTupleUnpack(NSString *key, NSString *value) = x;</div><div class="line">    </div><div class="line">    NSLog(@&quot;key:%@, value:%@&quot;, key, value);</div><div class="line">    </div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 3.字典转模型</div><div class="line"></div><div class="line">NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;flags.plist&quot; ofType:nil];</div><div class="line"></div><div class="line">NSArray *dicArray = [NSArray arrayWithContentsOfFile:filePath];</div><div class="line"></div><div class="line">NSMutableArray *items = [NSMutableArray array];</div><div class="line"></div><div class="line">// OC写法</div><div class="line">for (NSDictionary *dic in dicArray) &#123;</div><div class="line">    </div><div class="line">    //FlagItem *item = [FlagItem flagWithDict:dict];</div><div class="line">    //[items addObject:item];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// RAC写法</div><div class="line">[dicArray.rac_sequence.signal subscribeNext:^(id x) &#123;</div><div class="line">    // 利用RAC遍历， x：字典</div><div class="line">    </div><div class="line">    //FlagItem *item = [FlagItem flagWithDict:x];</div><div class="line">    //[items addObject:item];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// RAC高级用法（函数式编程）</div><div class="line">NSArray *flags = [[dicArray.rac_sequence map:^id(id value) &#123;</div><div class="line">    </div><div class="line">    return  [FlagItem flagWithDict:value];</div><div class="line">    </div><div class="line">&#125;] array];</div></pre></td></tr></table></figure>
<h4 id="RACCommand"><a href="#RACCommand" class="headerlink" title="RACCommand"></a>RACCommand</h4><blockquote>
<p>RAC中用于处理事件的类，可以把事件如何处理,事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。</p>
</blockquote>
<p> 一、RACCommand使用步骤:</p>
<ol>
<li>创建命令 initWithSignalBlock:(RACSignal * (^)(id input))signalBlock</li>
<li>在signalBlock中，创建RACSignal，并且作为signalBlock的返回值</li>
<li><p>执行命令 - (RACSignal *)execute:(id)input</p>
<p>二、RACCommand使用注意:</p>
</li>
<li><p>signalBlock必须要返回一个信号，不能传nil.</p>
</li>
<li>如果不想要传递信号，直接创建空的信号[RACSignal empty];</li>
<li>RACCommand中信号如果数据传递完，必须调用[subscriber sendCompleted]，这时命令才会执行完毕，否则永远处于执行中。</li>
<li><p>RACCommand需要被强引用，否则接收不到RACCommand中的信号，因此RACCommand中的信号是延迟发送的。</p>
<p>三、RACCommand设计思想：</p>
<p>内部signalBlock为什么要返回一个信号，这个信号有什么用。</p>
</li>
<li><p>在RAC开发中，通常会把网络请求封装到RACCommand，直接执行某个RACCommand就能发送请求。</p>
</li>
<li><p>当RACCommand内部请求到数据的时候，需要把请求的数据传递给外界，这时候就需要通过signalBlock返回的信号传递了。</p>
<p>四、如何拿到RACCommand中返回信号发出的数据。</p>
</li>
<li><p>RACCommand有个执行信号源executionSignals，这个是signal of signals(信号的信号),意思是信号发出的数据是信号，不是普通的类型。</p>
</li>
<li><p>订阅executionSignals就能拿到RACCommand中返回的信号，然后订阅signalBlock返回的信号，就能获取发出的值。</p>
<p>五、监听当前命令是否正在执行executing</p>
<p>六、使用场景,监听按钮点击，网络请求</p>
</li>
</ol>
<p>使用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">// 1.创建命令</div><div class="line">    RACCommand *command = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) &#123;</div><div class="line">        NSLog(@&quot;执行命令&quot;);</div><div class="line">        </div><div class="line">        // 返回空信号</div><div class="line">        //return [RACSignal empty];</div><div class="line">        </div><div class="line">        // 2.创建信号 传递数据</div><div class="line">        return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            </div><div class="line">            [subscriber sendNext:@&quot;请求数据&quot;];</div><div class="line">            </div><div class="line">            // 注意：数据传递完，最好调用sendCompleted,这时命令才执行完毕</div><div class="line">            [subscriber sendCompleted];</div><div class="line">            </div><div class="line">            return nil;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    // 强引用命令，不要被销毁，否则接收不到数据</div><div class="line">    _command = command;</div><div class="line">    </div><div class="line">    // 3.订阅RACCommand的信号</div><div class="line">    [command.executionSignals subscribeNext:^(id x) &#123;</div><div class="line">        [x subscribeNext:^(id x) &#123;</div><div class="line">            </div><div class="line">            NSLog(@&quot;订阅RACCommand的信号: %@&quot;, x);</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    // RAC高级用法</div><div class="line">    // switchToLatest:用于signal of signals，获取signal of signals发出的最新信号,也就是可以直接拿到RACCommand中的信号</div><div class="line">    [command.executionSignals.switchToLatest subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">        NSLog(@&quot;RAC高级用法: %@&quot;, x);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    // 4.监听命令是否执行完毕,默认会来一次，可以直接跳过，skip表示跳过第一次信号。</div><div class="line">    [[command.executing skip:1] subscribeNext:^(id x) &#123;</div><div class="line">       </div><div class="line">        if ([x boolValue] == YES) &#123;</div><div class="line">            </div><div class="line">            // 正在执行</div><div class="line">            NSLog(@&quot;正在执行&quot;);</div><div class="line">            </div><div class="line">        &#125; else &#123;</div><div class="line">            </div><div class="line">            // 执行完毕</div><div class="line">            NSLog(@&quot;执行完成&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    // 5.执行命名</div><div class="line">    [self.command execute:@1];</div></pre></td></tr></table></figure>
<h4 id="RACMulticastConnection"><a href="#RACMulticastConnection" class="headerlink" title="RACMulticastConnection"></a>RACMulticastConnection</h4><blockquote>
<p>用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。</p>
</blockquote>
<p>注意：RACMulticastConnection通过RACSignal的-publish或者-muticast:方法创建.</p>
<p>RACMulticastConnection使用步骤:</p>
<ol>
<li>创建信号 + (RACSignal <em>)createSignal:(RACDisposable </em> (^)(id<racsubscriber> subscriber))didSubscribe</racsubscriber></li>
<li>创建连接 RACMulticastConnection *connect = [signal publish];</li>
<li>订阅信号,注意：订阅的不在是之前的信号，而是连接的信号。 [connect.signal subscribeNext:nextBlock]</li>
<li>连接 [connect connect]</li>
</ol>
<p>RACMulticastConnection底层原理:</p>
<ol>
<li>创建connect，connect.sourceSignal -&gt; RACSignal(原始信号)  connect.signal -&gt; RACSubject</li>
<li>订阅connect.signal，会调用RACSubject的subscribeNext，创建订阅者，而且把订阅者保存起来，不会执行block。</li>
<li>[connect connect]内部会订阅RACSignal(原始信号)，并且订阅者是RACSubject<ol>
<li>订阅原始信号，就会调用原始信号中的didSubscribe</li>
<li>didSubscribe，拿到订阅者调用sendNext，其实是调用RACSubject的sendNext</li>
</ol>
</li>
<li>RACSubject的sendNext,会遍历RACSubject所有订阅者发送信号。<ul>
<li>因为刚刚第二步，都是在订阅RACSubject，因此会拿到第二步所有的订阅者，调用他们的nextBlock</li>
</ul>
</li>
</ol>
<p>需求：假设在一个信号中发送请求，每次订阅一次都会发送请求，这样就会导致多次请求。</p>
<p>解决：使用RACMulticastConnection就能解决.</p>
<p>问题：每次订阅一次都会发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// 创建请求信号</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;发送请求&quot;);</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    </div><div class="line">    return nil;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 订阅信号</div><div class="line">[signal subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;接受数据: %@&quot;, x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 再次订阅信号，会再次执行发送请求，也就是每次订阅都会发送一次请求</div><div class="line">[signal subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;接受数据: %@&quot;, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">2016-12-28 11:37:04.397 ReactiveCacoa[1505:340573] 发送请求</div><div class="line">2016-12-28 11:37:04.398 ReactiveCacoa[1505:340573] 接受数据: 1</div><div class="line">2016-12-28 11:37:04.398 ReactiveCacoa[1505:340573] 发送请求</div><div class="line">2016-12-28 11:37:04.398 ReactiveCacoa[1505:340573] 接受数据: 1</div></pre></td></tr></table></figure>
<p>可以发现每次订阅都会重新发送请求.</p>
<p>下面我们使用RACMulticastConnection：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;发送请求&quot;);</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    </div><div class="line">    return nil;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 创建连接</div><div class="line">RACMulticastConnection *connect = [signal publish];</div><div class="line"></div><div class="line">// 订阅信号</div><div class="line">// 注意：订阅信号，也不能激活信号，只是保存订阅者到数组，必须通过连接，当调用连接，就会一次性调用所有订阅者的SendNext</div><div class="line">[connect.signal subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;订阅者1信号: %@&quot;, x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[connect.signal subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;订阅者2信号: %@&quot;, x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 连接、激活信号</div><div class="line">[connect connect];</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2016-12-28 11:37:04.399 ReactiveCacoa[1505:340573] 发送请求</div><div class="line">2016-12-28 11:37:04.399 ReactiveCacoa[1505:340573] 订阅者1信号: 1</div><div class="line">2016-12-28 11:37:04.399 ReactiveCacoa[1505:340573] 订阅者2信号: 1</div></pre></td></tr></table></figure>
<h4 id="RACScheduler"><a href="#RACScheduler" class="headerlink" title="RACScheduler"></a>RACScheduler</h4><blockquote>
<p>RAC中的队列，用GCD封装的。</p>
</blockquote>
<h4 id="RACUnit"><a href="#RACUnit" class="headerlink" title="RACUnit"></a>RACUnit</h4><blockquote>
<p>表⽰stream不包含有意义的值,也就是看到这个，可以直接理解为nil.</p>
</blockquote>
<h4 id="RACEven"><a href="#RACEven" class="headerlink" title="RACEven"></a>RACEven</h4><blockquote>
<p>把数据包装成信号事件(signal event)。它主要通过RACSignal的-materialize来使用，然并卵。</p>
</blockquote>
<h1 id="ReactiveCocoa开发中常见用法"><a href="#ReactiveCocoa开发中常见用法" class="headerlink" title="ReactiveCocoa开发中常见用法"></a>ReactiveCocoa开发中常见用法</h1><ol>
<li>替换代理            </li>
<li>替换KVO</li>
<li>监听事件</li>
<li>替换通知</li>
<li>监听文本框文字改变</li>
<li>统一处理多个网络请求</li>
</ol>
<h4 id="替换代理："><a href="#替换代理：" class="headerlink" title="替换代理："></a>替换代理：</h4><p><strong>rac_signalForSelector:</strong></p>
<p><code>rac_signalForSelector:</code> 直接监听 <code>Selector</code> 事件的调用</p>
<p>应用场景：监听 <code>RedViewController</code> 中按钮的点击事件 <code>btnTap:</code></p>
<p>跳转到<code>RedViewController</code>前，先使用<code>rac_signalForSelector</code>订阅rvc中的 <code>btnTap:</code> 点击事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 使用segue跳转</div><div class="line">- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender &#123;</div><div class="line">- </div><div class="line">    if ([segue.identifier isEqualToString:@&quot;goRedVC&quot;]) &#123;</div><div class="line">        </div><div class="line">        RedViewController *rvc = segue.destinationViewController;</div><div class="line">        </div><div class="line">        // 订阅rvc中的 btnTap: 点击事件</div><div class="line">        [[rvc rac_signalForSelector:@selector(btnTap:)] subscribeNext:^(id x) &#123;</div><div class="line">        </div><div class="line">            NSLog(@&quot;RedVC btnTap！&quot;);</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>RedViewController.m</code> 中的按钮事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (IBAction)btnTap:(id)sender &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;!&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="替换KVO"><a href="#替换KVO" class="headerlink" title="替换KVO"></a>替换KVO</h4><p><strong>rac_valuesForKeyPath:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// KVO</div><div class="line">// 监听 slider 的 value 变化</div><div class="line">[[self.slider rac_valuesForKeyPath:@&quot;value&quot; observer:nil] subscribeNext:^(id x) &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;slider value Change：%@&quot;, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h4 id="监听事件"><a href="#监听事件" class="headerlink" title="监听事件"></a>监听事件</h4><p><strong>rac_signalForControlEvents:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 监听 btn 的 UIControlEventTouchUpInside 点击事件</div><div class="line">[[self.btn rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;btnTap&quot;);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h4 id="监听-textField-文字变化"><a href="#监听-textField-文字变化" class="headerlink" title="监听 textField 文字变化"></a>监听 textField 文字变化</h4><p><strong>rac_textSignal</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[self.textField rac_textSignal] subscribeNext:^(id x) &#123;</div><div class="line">        </div><div class="line">	NSLog(@&quot;textField change: %@&quot;, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h4 id="统一处理多个网络请求"><a href="#统一处理多个网络请求" class="headerlink" title="统一处理多个网络请求"></a>统一处理多个网络请求</h4><p><strong>rac_liftSelector:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">	// 处理多个请求都返回结果的时候，统一处理</div><div class="line">    // 如同时进行多个网络请求，每个请求都正确返回时，再去刷新页面</div><div class="line">    </div><div class="line">    RACSignal *signalOne = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        </div><div class="line">        // 网络请求1</div><div class="line">        // ...</div><div class="line">        </div><div class="line">        // 返回成功</div><div class="line">        [subscriber sendNext:@&quot;网络请求1 data&quot;];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    RACSignal *signalTwo = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        </div><div class="line">        // 网络请求2</div><div class="line">        // ...</div><div class="line">        </div><div class="line">        // 返回成功</div><div class="line">        [subscriber sendNext:@&quot;网络请求2 data&quot;];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [self rac_liftSelector:@selector(updateWithR1:R2:) withSignalsFromArray:@[signalOne, signalTwo]];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">// 更新界面</div><div class="line">- (void)updateWithR1:(id)r1 R2:(id)r2 &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;R1:%@, R2：%@ 完成！&quot;, r1, r2);</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a><strong>注意</strong>：</h4><ul>
<li><p><code>替换KVO</code>和 <code>监听文本框文字改变</code> 方法在创建监听方法时就会执行一次。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-12-28 16:53:50.746 ReactiveCacoa[4956:1246592] slider value Change：0.5</div><div class="line">2016-12-28 16:53:50.748 ReactiveCacoa[4956:1246592] textField change:</div></pre></td></tr></table></figure>
</li>
<li><p>使用<code>rac_liftSelector</code>时 <code>@selector(updateWithR1:R2:)</code>中的方 <strong>参数个数</strong> 要与 <strong>signal个数</strong> 相同，否则会被断言Crash！</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/21/2016-12-21-Objective-C-Category/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/21/2016-12-21-Objective-C-Category/" itemprop="url">Objective-C：Category</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-21T00:00:00+08:00">
                2016-12-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>本文转载自美图点评技术团队的：<a href="http://tech.meituan.com/DiveIntoCategory.html" target="_blank" rel="external">深入理解Objective-C：Category</a>，略有修改。</p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>无论一个类设计的多么完美，在未来的需求演进中，都有可能会碰到一些无法预测的情况。那怎么扩展已有的类呢？一般而言，继承和组合是不错的选择。但是在Objective-C 2.0中，又提供了category这个语言特性，可以动态地为已有类添加新行为。如今category已经遍布于Objective-C代码的各个角落，从Apple官方的framework到各个开源框架，从功能繁复的大型APP到简单的应用，catagory无处不在。本文对category做了比较全面的整理，希望对读者有所裨益。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>本文系学习Objective-C的runtime源码时整理所成，主要剖析了category在runtime层的实现原理以及和category相关的方方面面，内容包括：</p>
<ul>
<li>初入宝地 category简介</li>
<li>连类比事 category和extension</li>
<li>挑灯细览 category真面目</li>
<li>追本溯源 category如何加载</li>
<li>旁枝末叶 category和+load方法</li>
<li>触类旁通 category和方法覆盖</li>
<li>更上一层 category和关联对象</li>
</ul>
<h2 id="初入宝地-Category简介"><a href="#初入宝地-Category简介" class="headerlink" title="初入宝地 Category简介"></a>初入宝地 Category简介</h2><p>Category是Objective-C 2.0之后添加的语言特性，Category的主要作用是为已经存在的类添加方法。除此之外，apple还推荐了Category的另外两个使用场景,详见<a href="https://developer.apple.com/library/content/documentation/General/Conceptual/DevPedia-CocoaCore/Category.html" target="_blank" rel="external">Apple Category文档</a>。</p>
<ul>
<li>可以把类的实现分开在几个不同的文件里面。这样做有几个显而易见的好处，<ul>
<li>可以减少单个文件的体积 b)可以把不同的功能组织到不同的category里 </li>
<li>可以由多个开发者共同完成一个类 </li>
<li>可以按需加载想要的 Category 等等。</li>
</ul>
</li>
<li>声明私有方法</li>
</ul>
<p>不过除了apple推荐的使用场景，广大开发者脑洞大开，还衍生出了category的其他几个使用场景：</p>
<ul>
<li>模拟多继承</li>
<li>把framework的私有方法公开</li>
</ul>
<p>Objective-C的这个语言特性对于纯动态语言来说可能不算什么，比如javascript，你可以随时为一个“类”或者对象添加任意方法和实例变量。但是对于不是那么“动态”的语言而言，这确实是一个了不起的特性。</p>
<h2 id="连类比事-Category和Extension"><a href="#连类比事-Category和Extension" class="headerlink" title="连类比事 Category和Extension"></a>连类比事 Category和Extension</h2><p>extension看起来很像一个匿名的category，但是extension和有名字的category几乎完全是两个东西。 extension在编译期决议，它就是类的一部分，在编译期和头文件里的@interface以及实现文件里的@implement一起形成一个完整的类，它伴随类的产生而产生，亦随之一起消亡。extension一般用来隐藏类的私有信息，你必须有一个类的源码才能为一个类添加extension，所以你无法为系统的类比如NSString添加extension。(详见<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html" target="_blank" rel="external">Apple文档</a>)</p>
<h2 id="挑灯细览-category真面目"><a href="#挑灯细览-category真面目" class="headerlink" title="挑灯细览 category真面目"></a>挑灯细览 category真面目</h2><p>我们知道，所有的OC类和对象，在runtime层都是用struct表示的，category也不例外，在runtime层，category用结构体category_t（在objc-runtime-new.h中可以找到此定义），它包含了</p>
<ol>
<li>类的名字（name）</li>
</ol>
<ul>
<li>类（cls）</li>
<li>category中所有给类添加的实例方法的列表（instanceMethods）</li>
<li>category中所有添加的类方法的列表（classMethods）</li>
<li>category实现的所有协议的列表（protocols）</li>
<li>category中添加的所有属性（instanceProperties）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef struct category_t &#123;</div><div class="line">    const char *name;</div><div class="line">    classref_t cls;</div><div class="line">    struct method_list_t *instanceMethods;</div><div class="line">    struct method_list_t *classMethods;</div><div class="line">    struct protocol_list_t *protocols;</div><div class="line">    struct property_list_t *instanceProperties;</div><div class="line">&#125; category_t;</div></pre></td></tr></table></figure>
<p>从category的定义也可以看出category的可为（可以添加实例方法，类方法，甚至可以实现协议，添加属性）和不可为（无法添加实例变量）。<br>ok，我们先去写一个category看一下category到底为何物：</p>
<p>MyClass.h：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface MyClass : NSObject</div><div class="line"></div><div class="line">- (void)printName;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@interface MyClass(MyAddition)</div><div class="line"></div><div class="line">@property(nonatomic, copy) NSString *name;</div><div class="line"></div><div class="line">- (void)printName;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>MyClass.m：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#import &quot;MyClass.h&quot;</div><div class="line"></div><div class="line">@implementation MyClass</div><div class="line"></div><div class="line">- (void)printName</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;%@&quot;,@&quot;MyClass&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation MyClass(MyAddition)</div><div class="line"></div><div class="line">- (void)printName</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;%@&quot;,@&quot;MyAddition&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>我们使用clang的命令去看看category到底会变成什么：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">clang -rewrite-objc MyClass.m</div></pre></td></tr></table></figure>
<p>好吧，我们得到了一个3M大小，10w多行的.cpp文件（这绝对是Apple值得吐槽的一点），我们忽略掉所有和我们无关的东西，在文件的最后，我们找到了如下代码片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">static struct /*_method_list_t*/ &#123;</div><div class="line">unsigned int entsize;  // sizeof(struct _objc_method)</div><div class="line">unsigned int method_count;</div><div class="line">struct _objc_method method_list[1];</div><div class="line">&#125; _OBJC_$_CATEGORY_INSTANCE_METHODS_MyClass_$_MyAddition __attribute__ ((used, section (&quot;__DATA,__objc_const&quot;))) = &#123;</div><div class="line">sizeof(_objc_method),</div><div class="line">1,</div><div class="line">&#123;&#123;(struct objc_selector *)&quot;printName&quot;, &quot;v16@0:8&quot;, (void *)_I_MyClass_MyAddition_printName&#125;&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">static struct /*_prop_list_t*/ &#123;</div><div class="line">unsigned int entsize;  // sizeof(struct _prop_t)</div><div class="line">unsigned int count_of_properties;</div><div class="line">struct _prop_t prop_list[1];</div><div class="line">&#125; _OBJC_$_PROP_LIST_MyClass_$_MyAddition __attribute__ ((used, section (&quot;__DATA,__objc_const&quot;))) = &#123;</div><div class="line">sizeof(_prop_t),</div><div class="line">1,</div><div class="line">&#123;&#123;&quot;name&quot;,&quot;T@\&quot;NSString\&quot;,C,N&quot;&#125;&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">extern &quot;C&quot; __declspec(dllexport) struct _class_t OBJC_CLASS_$_MyClass;</div><div class="line"></div><div class="line">static struct _category_t _OBJC_$_CATEGORY_MyClass_$_MyAddition __attribute__ ((used, section (&quot;__DATA,__objc_const&quot;))) =</div><div class="line">&#123;</div><div class="line">&quot;MyClass&quot;,</div><div class="line">0, // &amp;OBJC_CLASS_$_MyClass,</div><div class="line">(const struct _method_list_t *)&amp;_OBJC_$_CATEGORY_INSTANCE_METHODS_MyClass_$_MyAddition,</div><div class="line">0,</div><div class="line">0,</div><div class="line">(const struct _prop_list_t *)&amp;_OBJC_$_PROP_LIST_MyClass_$_MyAddition,</div><div class="line">&#125;;</div><div class="line">static void OBJC_CATEGORY_SETUP_$_MyClass_$_MyAddition(void ) &#123;</div><div class="line">_OBJC_$_CATEGORY_MyClass_$_MyAddition.cls = &amp;OBJC_CLASS_$_MyClass;</div><div class="line">&#125;</div><div class="line">#pragma section(&quot;.objc_inithooks$B&quot;, long, read, write)</div><div class="line">__declspec(allocate(&quot;.objc_inithooks$B&quot;)) static void *OBJC_CATEGORY_SETUP[] = &#123;</div><div class="line">(void *)&amp;OBJC_CATEGORY_SETUP_$_MyClass_$_MyAddition,</div><div class="line">&#125;;</div><div class="line">static struct _class_t *L_OBJC_LABEL_CLASS_$ [1] __attribute__((used, section (&quot;__DATA, __objc_classlist,regular,no_dead_strip&quot;)))= &#123;</div><div class="line">&amp;OBJC_CLASS_$_MyClass,</div><div class="line">&#125;;</div><div class="line">static struct _class_t *_OBJC_LABEL_NONLAZY_CLASS_$[] = &#123;</div><div class="line">&amp;OBJC_CLASS_$_MyClass,</div><div class="line">&#125;;</div><div class="line">static struct _category_t *L_OBJC_LABEL_CATEGORY_$ [1] __attribute__((used, section (&quot;__DATA, __objc_catlist,regular,no_dead_strip&quot;)))= &#123;</div><div class="line">&amp;_OBJC_$_CATEGORY_MyClass_$_MyAddition,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>我们可以看到，</p>
<ol>
<li>首先编译器生成了实例方法列表OBJC$_CATEGORY_INSTANCE_METHODSMyClass$_MyAddition和属性列表OBJC$_PROP_LISTMyClass$_MyAddition，两者的命名都遵循了公共前缀+类名+category名字的命名方式，而且实例方法列表里面填充的正是我们在MyAddition这个category里面写的方法printName，而属性列表里面填充的也正是我们在MyAddition里添加的name属性。还有一个需要注意到的事实就是category的名字用来给各种列表以及后面的category结构体本身命名，而且有static来修饰，所以在同一个编译单元里我们的category名不能重复，否则会出现编译错误。</li>
</ol>
<ul>
<li>其次，编译器生成了category本身OBJC$_CATEGORYMyClass$_MyAddition，并用前面生成的列表来初始化category本身。</li>
<li>最后，编译器在DATA段下的objc_catlist section里保存了一个大小为1的category_t的数组L_OBJC<em>LABELCATEGORY$（当然，如果有多个category，会生成对应长度的数组^</em>^），用于运行期category的加载。<br>到这里，编译器的工作就接近尾声了，对于category在运行期怎么加载，我们下节揭晓。</li>
</ul>
<h2 id="追本溯源-category如何加载"><a href="#追本溯源-category如何加载" class="headerlink" title="追本溯源 category如何加载"></a>追本溯源 category如何加载</h2><p>我们知道，Objective-C的运行是依赖OC的runtime的，而OC的runtime和其他系统库一样，是OS X和iOS通过dyld动态加载的。<br>想了解更多dyld地同学可以移步<a href="https://www.mikeash.com/pyblog/friday-qa-2012-11-09-dyld-dynamic-linking-on-os-x.html" target="_blank" rel="external">这里</a>。</p>
<p>对于OC运行时，入口方法如下（在objc-os.mm文件中）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">void _objc_init(void)</div><div class="line">&#123;</div><div class="line">    static bool initialized = false;</div><div class="line">    if (initialized) return;</div><div class="line">    initialized = true;</div><div class="line"></div><div class="line">    // fixme defer initialization until an objc-using image is found?</div><div class="line">    environ_init();</div><div class="line">    tls_init();</div><div class="line">    lock_init();</div><div class="line">    exception_init();</div><div class="line"></div><div class="line">    // Register for unmap first, in case some +load unmaps something</div><div class="line">    _dyld_register_func_for_remove_image(&amp;unmap_image);</div><div class="line">    dyld_register_image_state_change_handler(dyld_image_state_bound,</div><div class="line">                                             1/*batch*/, &amp;map_images);</div><div class="line">    dyld_register_image_state_change_handler(dyld_image_state_dependents_initialized, 0/*not batch*/, &amp;load_images);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>category被附加到类上面是在map_images的时候发生的，在new-ABI的标准下，_objc_init里面的调用的map_images最终会调用objc-runtime-new.mm里面的_read_images方法，而在_read_images方法的结尾，有以下的代码片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">// Discover categories. </div><div class="line">    for (EACH_HEADER) &#123;</div><div class="line">        category_t **catlist =</div><div class="line">            _getObjc2CategoryList(hi, &amp;count);</div><div class="line">        for (i = 0; i &lt; count; i++) &#123;</div><div class="line">            category_t *cat = catlist[i];</div><div class="line">            class_t *cls = remapClass(cat-&gt;cls);</div><div class="line"></div><div class="line">            if (!cls) &#123;</div><div class="line">                // Category&apos;s target class is missing (probably weak-linked).</div><div class="line">                // Disavow any knowledge of this category.</div><div class="line">                catlist[i] = NULL;</div><div class="line">                if (PrintConnecting) &#123;</div><div class="line">                    _objc_inform(&quot;CLASS: IGNORING category \?\?\?(%s) %p with &quot;</div><div class="line">                                 &quot;missing weak-linked target class&quot;,</div><div class="line">                                 cat-&gt;name, cat);</div><div class="line">                &#125;</div><div class="line">                continue;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            // Process this category. </div><div class="line">            // First, register the category with its target class. </div><div class="line">            // Then, rebuild the class&apos;s method lists (etc) if </div><div class="line">            // the class is realized. </div><div class="line">            BOOL classExists = NO;</div><div class="line">            if (cat-&gt;instanceMethods ||  cat-&gt;protocols </div><div class="line">                ||  cat-&gt;instanceProperties)</div><div class="line">            &#123;</div><div class="line">                addUnattachedCategoryForClass(cat, cls, hi);</div><div class="line">                if (isRealized(cls)) &#123;</div><div class="line">                    remethodizeClass(cls);</div><div class="line">                    classExists = YES;</div><div class="line">                &#125;</div><div class="line">                if (PrintConnecting) &#123;</div><div class="line">                    _objc_inform(&quot;CLASS: found category -%s(%s) %s&quot;,</div><div class="line">                                 getName(cls), cat-&gt;name,</div><div class="line">                                 classExists ? &quot;on existing class&quot; : &quot;&quot;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (cat-&gt;classMethods  ||  cat-&gt;protocols </div><div class="line">                /* ||  cat-&gt;classProperties */)</div><div class="line">            &#123;</div><div class="line">                addUnattachedCategoryForClass(cat, cls-&gt;isa, hi);</div><div class="line">                if (isRealized(cls-&gt;isa)) &#123;</div><div class="line">                    remethodizeClass(cls-&gt;isa);</div><div class="line">                &#125;</div><div class="line">                if (PrintConnecting) &#123;</div><div class="line">                    _objc_inform(&quot;CLASS: found category +%s(%s)&quot;,</div><div class="line">                                 getName(cls), cat-&gt;name);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>首先，我们拿到的catlist就是上节中讲到的编译器为我们准备的category_t数组，关于是如何加载catlist本身的，我们暂且不表，这和category本身的关系也不大，有兴趣的同学可以去研究以下Apple的二进制格式和load机制。</p>
<p>略去PrintConnecting这个用于log的东西，这段代码很容易理解：</p>
<ol>
<li>把category的实例方法、协议以及属性添加到类上</li>
<li>把category的类方法和协议添加到类的metaclass上</li>
</ol>
<p>值得注意的是，在代码中有一小段注释 <code>/ || cat-&gt;classProperties /</code>，看来苹果有过给类添加属性的计划啊。<br>ok，我们接着往里看，category的各种列表是怎么最终添加到类上的，就拿实例方法列表来说吧：<br>在上述的代码片段里，addUnattachedCategoryForClass只是把类和category做一个关联映射，而remethodizeClass才是真正去处理添加事宜的功臣。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">static void remethodizeClass(class_t *cls)</div><div class="line">&#123;</div><div class="line">    category_list *cats;</div><div class="line">    BOOL isMeta;</div><div class="line"></div><div class="line">    rwlock_assert_writing(&amp;runtimeLock);</div><div class="line"></div><div class="line">    isMeta = isMetaClass(cls);</div><div class="line"></div><div class="line">    // Re-methodizing: check for more categories</div><div class="line">    if ((cats = unattachedCategoriesForClass(cls))) &#123;</div><div class="line">        chained_property_list *newproperties;</div><div class="line">        const protocol_list_t **newprotos;</div><div class="line"></div><div class="line">        if (PrintConnecting) &#123;</div><div class="line">            _objc_inform(&quot;CLASS: attaching categories to class &apos;%s&apos; %s&quot;,</div><div class="line">                         getName(cls), isMeta ? &quot;(meta)&quot; : &quot;&quot;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // Update methods, properties, protocols</div><div class="line"></div><div class="line">        BOOL vtableAffected = NO;</div><div class="line">        attachCategoryMethods(cls, cats, &amp;vtableAffected);</div><div class="line"></div><div class="line">        newproperties = buildPropertyList(NULL, cats, isMeta);</div><div class="line">        if (newproperties) &#123;</div><div class="line">            newproperties-&gt;next = cls-&gt;data()-&gt;properties;</div><div class="line">            cls-&gt;data()-&gt;properties = newproperties;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        newprotos = buildProtocolList(cats, NULL, cls-&gt;data()-&gt;protocols);</div><div class="line">        if (cls-&gt;data()-&gt;protocols  &amp;&amp;  cls-&gt;data()-&gt;protocols != newprotos) &#123;</div><div class="line">            _free_internal(cls-&gt;data()-&gt;protocols);</div><div class="line">        &#125;</div><div class="line">        cls-&gt;data()-&gt;protocols = newprotos;</div><div class="line"></div><div class="line">        _free_internal(cats);</div><div class="line"></div><div class="line">        // Update method caches and vtables</div><div class="line">        flushCaches(cls);</div><div class="line">        if (vtableAffected) flushVtables(cls);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而对于添加类的实例方法而言，又会去调用attachCategoryMethods这个方法，我们去看下attachCategoryMethods：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">static void </div><div class="line">attachCategoryMethods(class_t *cls, category_list *cats,</div><div class="line">                      BOOL *inoutVtablesAffected)</div><div class="line">&#123;</div><div class="line">    if (!cats) return;</div><div class="line">    if (PrintReplacedMethods) printReplacements(cls, cats);</div><div class="line"></div><div class="line">    BOOL isMeta = isMetaClass(cls);</div><div class="line">    method_list_t **mlists = (method_list_t **)</div><div class="line">        _malloc_internal(cats-&gt;count * sizeof(*mlists));</div><div class="line"></div><div class="line">    // Count backwards through cats to get newest categories first</div><div class="line">    int mcount = 0;</div><div class="line">    int i = cats-&gt;count;</div><div class="line">    BOOL fromBundle = NO;</div><div class="line">    while (i--) &#123;</div><div class="line">        method_list_t *mlist = cat_method_list(cats-&gt;list[i].cat, isMeta);</div><div class="line">        if (mlist) &#123;</div><div class="line">            mlists[mcount++] = mlist;</div><div class="line">            fromBundle |= cats-&gt;list[i].fromBundle;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    attachMethodLists(cls, mlists, mcount, NO, fromBundle, inoutVtablesAffected);</div><div class="line"></div><div class="line">    _free_internal(mlists);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>attachCategoryMethods做的工作相对比较简单，它只是把所有category的实例方法列表拼成了一个大的实例方法列表，然后转交给了attachMethodLists方法（我发誓，这是本节我们看的最后一段代码了^_^），这个方法有点长，我们只看一小段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">for (uint32_t m = 0;</div><div class="line">             (scanForCustomRR || scanForCustomAWZ)  &amp;&amp;  m &lt; mlist-&gt;count;</div><div class="line">             m++)</div><div class="line">        &#123;</div><div class="line">            SEL sel = method_list_nth(mlist, m)-&gt;name;</div><div class="line">            if (scanForCustomRR  &amp;&amp;  isRRSelector(sel)) &#123;</div><div class="line">                cls-&gt;setHasCustomRR();</div><div class="line">                scanForCustomRR = false;</div><div class="line">            &#125; else if (scanForCustomAWZ  &amp;&amp;  isAWZSelector(sel)) &#123;</div><div class="line">                cls-&gt;setHasCustomAWZ();</div><div class="line">                scanForCustomAWZ = false;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // Fill method list array</div><div class="line">        newLists[newCount++] = mlist;</div><div class="line">    .</div><div class="line">    .</div><div class="line">    .</div><div class="line"></div><div class="line">    // Copy old methods to the method list array</div><div class="line">    for (i = 0; i &lt; oldCount; i++) &#123;</div><div class="line">        newLists[newCount++] = oldLists[i];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>需要注意的有两点：</p>
<ol>
<li>category的方法没有“完全替换掉”原来类已经有的方法，也就是说如果category和原来类都有methodA，那么category附加完成之后，类的方法列表里会有两个methodA</li>
<li>category的方法被放到了新方法列表的前面，而原来类的方法被放到了新方法列表的后面，这也就是我们平常所说的category的方法会“覆盖”掉原来类的同名方法，这是因为运行时在查找方法的时候是顺着方法列表的顺序查找的，它只要一找到对应名字的方法，就会罢休^_^，殊不知后面可能还有一样名字的方法。</li>
</ol>
<h2 id="旁枝末叶-category-和-load-方法"><a href="#旁枝末叶-category-和-load-方法" class="headerlink" title="旁枝末叶 category 和 +load 方法"></a>旁枝末叶 category 和 +load 方法</h2><p>我们知道，在类和category中都可以有+load方法，那么有两个问题：</p>
<ol>
<li>在类的+load方法调用的时候，我们可以调用category中声明的方法么？</li>
<li>这么些个+load方法，调用顺序是咋样的呢？</li>
</ol>
<p>鉴于上述几节我们看的代码太多了，对于这两个问题我们先来看一点直观的：</p>
<p><img src="http://tech.meituan.com/img/diveintocategory/project.png" alt=""></p>
<p>我们的代码里有MyClass和MyClass的两个category （Category1和Category2），MyClass和两个category都添加了+load方法，并且Category1和Category2都写了MyClass的printName方法。<br>在Xcode中点击Edit Scheme，添加如下两个环境变量（可以在执行load方法以及加载category的时候打印log信息，更多的环境变量选项可参见objc-private.h）:<br><img src="http://tech.meituan.com/img/diveintocategory/environment_vars.png" alt=""></p>
<p>运行项目，我们会看到控制台打印很多东西出来，我们只找到我们想要的信息，顺序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">objc[1187]: REPLACED: -[MyClass printName] by category Category1</div><div class="line">objc[1187]: REPLACED: -[MyClass printName] by category Category2</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">objc[1187]: LOAD: class &apos;MyClass&apos; scheduled for +load</div><div class="line">objc[1187]: LOAD: category &apos;MyClass(Category1)&apos; scheduled for +load</div><div class="line">objc[1187]: LOAD: category &apos;MyClass(Category2)&apos; scheduled for +load</div><div class="line">objc[1187]: LOAD: +[MyClass load]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">objc[1187]: LOAD: +[MyClass(Category1) load]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">objc[1187]: LOAD: +[MyClass(Category2) load]</div></pre></td></tr></table></figure>
<p>所以，对于上面两个问题，答案是很明显的：</p>
<ol>
<li>可以调用，因为附加category到类的工作会先于+load方法的执行</li>
</ol>
<ul>
<li>+load的执行顺序是先类，后category，而category的+load执行顺序是根据编译顺序决定的。<br>目前的编译顺序是这样的：</li>
</ul>
<p><img src="http://tech.meituan.com/img/diveintocategory/compile1.png" alt=""></p>
<p>我们调整一个Category1和Category2的编译顺序，run。ok，我们可以看到控制台的输出顺序变了：</p>
<p><img src="http://tech.meituan.com/img/diveintocategory/compile2.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">objc[1187]: REPLACED: -[MyClass printName] by category Category2</div><div class="line">objc[1187]: REPLACED: -[MyClass printName] by category Category1</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">objc[1187]: LOAD: class &apos;MyClass&apos; scheduled for +load</div><div class="line">objc[1187]: LOAD: category &apos;MyClass(Category2)&apos; scheduled for +load</div><div class="line">objc[1187]: LOAD: category &apos;MyClass(Category1)&apos; scheduled for +load</div><div class="line">objc[1187]: LOAD: +[MyClass load]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">objc[1187]: LOAD: +[MyClass(Category2) load]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">objc[1187]: LOAD: +[MyClass(Category1) load]</div></pre></td></tr></table></figure>
<p>虽然对于+load的执行顺序是这样，但是对于“覆盖”掉的方法，则会先找到最后一个编译的category里的对应方法。</p>
<p>这一节我们只是用很直观的方式得到了问题的答案，有兴趣的同学可以继续去研究一下OC的运行时代码。</p>
<h2 id="触类旁通-category-和方法覆盖"><a href="#触类旁通-category-和方法覆盖" class="headerlink" title="触类旁通 category 和方法覆盖"></a>触类旁通 category 和方法覆盖</h2><p>鉴于上面几节我们已经把原理都讲了，这一节只有一个问题:</p>
<p>怎么调用到原来类中被category覆盖掉的方法？</p>
<p>对于这个问题，我们已经知道category其实并不是完全替换掉原来类的同名方法，只是category在方法列表的前面而已，所以我们只要顺着方法列表找到最后一个对应名字的方法，就可以调用原来类的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">Class currentClass = [MyClass class];</div><div class="line">MyClass *my = [[MyClass alloc] init];</div><div class="line"></div><div class="line">if (currentClass) &#123;</div><div class="line">    unsigned int methodCount;</div><div class="line">    Method *methodList = class_copyMethodList(currentClass, &amp;methodCount);</div><div class="line">    IMP lastImp = NULL;</div><div class="line">    SEL lastSel = NULL;</div><div class="line">    for (NSInteger i = 0; i &lt; methodCount; i++) &#123;</div><div class="line">        Method method = methodList[i];</div><div class="line">        NSString *methodName = [NSString stringWithCString:sel_getName(method_getName(method)) </div><div class="line">                                        encoding:NSUTF8StringEncoding];</div><div class="line">        if ([@&quot;printName&quot; isEqualToString:methodName]) &#123;</div><div class="line">            lastImp = method_getImplementation(method);</div><div class="line">            lastSel = method_getName(method);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    typedef void (*fn)(id,SEL);</div><div class="line"></div><div class="line">    if (lastImp != NULL) &#123;</div><div class="line">        fn f = (fn)lastImp;</div><div class="line">        f(my,lastSel);</div><div class="line">    &#125;</div><div class="line">    free(methodList);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="更上一层-category-和关联对象"><a href="#更上一层-category-和关联对象" class="headerlink" title="更上一层 category 和关联对象"></a>更上一层 category 和关联对象</h2><p>如上所见，我们知道在category里面是无法为category添加实例变量的。但是我们很多时候需要在category中添加和对象关联的值，这个时候可以求助关联对象来实现。</p>
<p>MyClass+Category1.h:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &quot;MyClass.h&quot;</div><div class="line"></div><div class="line">@interface MyClass (Category1)</div><div class="line"></div><div class="line">@property(nonatomic,copy) NSString *name;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>MyClass+Category1.m:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#import &quot;MyClass+Category1.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation MyClass (Category1)</div><div class="line"></div><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;%@&quot;,@&quot;load in Category1&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setName:(NSString *)name</div><div class="line">&#123;</div><div class="line">    objc_setAssociatedObject(self,</div><div class="line">                             &quot;name&quot;,</div><div class="line">                             name,</div><div class="line">                             OBJC_ASSOCIATION_COPY);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString*)name</div><div class="line">&#123;</div><div class="line">    NSString *nameObject = objc_getAssociatedObject(self, &quot;name&quot;);</div><div class="line">    return nameObject;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>但是关联对象又是存在什么地方呢？ 如何存储？ 对象销毁时候如何处理关联对象呢？<br>我们去翻一下runtime的源码，在objc-references.mm文件中有个方法_object_set_associative_reference：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">void _object_set_associative_reference(id object, void *key, id value, uintptr_t policy) &#123;</div><div class="line">    // retain the new value (if any) outside the lock.</div><div class="line">    ObjcAssociation old_association(0, nil);</div><div class="line">    id new_value = value ? acquireValue(value, policy) : nil;</div><div class="line">    &#123;</div><div class="line">        AssociationsManager manager;</div><div class="line">        AssociationsHashMap &amp;associations(manager.associations());</div><div class="line">        disguised_ptr_t disguised_object = DISGUISE(object);</div><div class="line">        if (new_value) &#123;</div><div class="line">            // break any existing association.</div><div class="line">            AssociationsHashMap::iterator i = associations.find(disguised_object);</div><div class="line">            if (i != associations.end()) &#123;</div><div class="line">                // secondary table exists</div><div class="line">                ObjectAssociationMap *refs = i-&gt;second;</div><div class="line">                ObjectAssociationMap::iterator j = refs-&gt;find(key);</div><div class="line">                if (j != refs-&gt;end()) &#123;</div><div class="line">                    old_association = j-&gt;second;</div><div class="line">                    j-&gt;second = ObjcAssociation(policy, new_value);</div><div class="line">                &#125; else &#123;</div><div class="line">                    (*refs)[key] = ObjcAssociation(policy, new_value);</div><div class="line">                &#125;</div><div class="line">            &#125; else &#123;</div><div class="line">                // create the new association (first time).</div><div class="line">                ObjectAssociationMap *refs = new ObjectAssociationMap;</div><div class="line">                associations[disguised_object] = refs;</div><div class="line">                (*refs)[key] = ObjcAssociation(policy, new_value);</div><div class="line">                _class_setInstancesHaveAssociatedObjects(_object_getClass(object));</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            // setting the association to nil breaks the association.</div><div class="line">            AssociationsHashMap::iterator i = associations.find(disguised_object);</div><div class="line">            if (i !=  associations.end()) &#123;</div><div class="line">                ObjectAssociationMap *refs = i-&gt;second;</div><div class="line">                ObjectAssociationMap::iterator j = refs-&gt;find(key);</div><div class="line">                if (j != refs-&gt;end()) &#123;</div><div class="line">                    old_association = j-&gt;second;</div><div class="line">                    refs-&gt;erase(j);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // release the old value (outside of the lock).</div><div class="line">    if (old_association.hasValue()) ReleaseValue()(old_association);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可以看到所有的关联对象都由AssociationsManager管理，而AssociationsManager定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class AssociationsManager &#123;</div><div class="line">    static OSSpinLock _lock;</div><div class="line">    static AssociationsHashMap *_map;               // associative references:  object pointer -&gt; PtrPtrHashMap.</div><div class="line">public:</div><div class="line">    AssociationsManager()   &#123; OSSpinLockLock(&amp;_lock); &#125;</div><div class="line">    ~AssociationsManager()  &#123; OSSpinLockUnlock(&amp;_lock); &#125;</div><div class="line"></div><div class="line">    AssociationsHashMap &amp;associations() &#123;</div><div class="line">        if (_map == NULL)</div><div class="line">            _map = new AssociationsHashMap();</div><div class="line">        return *_map;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>AssociationsManager里面是由一个静态AssociationsHashMap来存储所有的关联对象的。这相当于把所有对象的关联对象都存在一个全局map里面。而map的的key是这个对象的指针地址（任意两个不同对象的指针地址一定是不同的），而这个map的value又是另外一个AssociationsHashMap，里面保存了关联对象的kv对。<br>而在对象的销毁逻辑里面，见objc-runtime-new.mm:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">void *objc_destructInstance(id obj) </div><div class="line">&#123;</div><div class="line">    if (obj) &#123;</div><div class="line">        Class isa_gen = _object_getClass(obj);</div><div class="line">        class_t *isa = newcls(isa_gen);</div><div class="line"></div><div class="line">        // Read all of the flags at once for performance.</div><div class="line">        bool cxx = hasCxxStructors(isa);</div><div class="line">        bool assoc = !UseGC &amp;&amp; _class_instancesHaveAssociatedObjects(isa_gen);</div><div class="line"></div><div class="line">        // This order is important.</div><div class="line">        if (cxx) object_cxxDestruct(obj);</div><div class="line">        if (assoc) _object_remove_assocations(obj);</div><div class="line"></div><div class="line">        if (!UseGC) objc_clear_deallocating(obj);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>嗯，runtime的销毁对象函数objc_destructInstance里面会判断这个对象有没有关联对象，如果有，会调用_object_remove_assocations做关联对象的清理工作。</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>正如侯捷先生所讲-“源码面前，了无秘密”，Apple的Cocoa Touch框架虽然并不开源，但是Objective-C的runtime和Core Foundation却是完全开放源码的(在<a href="http://www.opensource.apple.com/tarballs/" target="_blank" rel="external">http://www.opensource.apple.com/tarballs/</a>可以下载到全部的开源代码)。<br>本系列runtime源码学习将会持续更新，意犹未尽的同学可以自行到上述网站下载源码学习。行笔简陋，如有错误，望指正。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/13/2016-12-13-定时器你真的会使用吗？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/13/2016-12-13-定时器你真的会使用吗？/" itemprop="url">定时器 你真的会使用吗？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-13T00:00:00+08:00">
                2016-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>定时器的使用是软件开发基础技能，用于延时执行或重复执行某些方法。我相信大部分人接触iOS的定时器都是从<br><code>[NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(action:) userInfo:nil repeats:YES]</code>这段代码开始的吧。</p>
<p>但是关于iOS定时器，你真的会用吗？</p>
</blockquote>
<h1 id="iOS定时器"><a href="#iOS定时器" class="headerlink" title="iOS定时器"></a>iOS定时器</h1><p>首先来介绍iOS中的定时器</p>
<p>iOS中的定时器大致分为这几类：</p>
<ul>
<li><strong>NSTimer</strong></li>
<li><strong>CADisplayLink</strong></li>
<li><strong>GCD定时器</strong></li>
</ul>
<h3 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h3><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p><strong>NSTime</strong>定时器是我们比较常使用的定时器，比较常使用的方法有两种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ (NSTimer *)timerWithTimeInterval:(NSTimeInterval)ti target:(id)aTarget selector:(SEL)aSelector userInfo:(nullable id)userInfo repeats:(BOOL)yesOrNo;</div><div class="line"></div><div class="line">+ (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)ti target:(id)aTarget selector:(SEL)aSelector userInfo:(nullable id)userInfo repeats:(BOOL)yesOrNo;</div></pre></td></tr></table></figure>
<p>这两种方法都是创建一个定时器，区别是用<code>timerWithTimeInterval:</code>方法创建的定时器需要手动加入RunLoop中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 创建NSTimer对象</div><div class="line">NSTimer *timer = [NSTimer timerWithTimeInterval:3 target:self selector:@selector(timerAction) userInfo:nil repeats:YES];</div><div class="line">// 加入RunLoop中</div><div class="line">[[NSRunLoop mainRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];</div></pre></td></tr></table></figure>
<p>需要<strong>注意</strong>的是： <code>UIScrollView</code> 滑动时执行的是 <code>UITrackingRunLoopMode</code>，<code>NSDefaultRunLoopMode</code>被挂起，会导致定时器失效，等恢复为<strong>滑动结束</strong>时才恢复定时器。其原因可以查看我这篇<a href="http://www.jianshu.com/p/c4f552ceda63" target="_blank" rel="external">《Objective-C RunLoop 详解》</a>中的 “RunLoop 的 Mode“章节，有详细的介绍。</p>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)startTimer&#123;</div><div class="line">    NSTimer *UIScrollView = [NSTimer timerWithTimeInterval:0.5 target:self selector:@selector(action:) userInfo:nil repeats:YES];</div><div class="line">    [[NSRunLoop mainRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)action:(NSTimer *)sender &#123;</div><div class="line">    static int i = 0;</div><div class="line">    NSLog(@&quot;NSTimer: %d&quot;,i);</div><div class="line">    i++;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将<code>timer</code>添加到<strong>NSDefaultRunLoopMode</strong>中，没0.5秒打印一次，然后滑动<code>UIScrollView</code>.</p>
<p>打印台输出：</p>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79gw1farbzzwcevj30ci04ljtm.jpg" alt=""></p>
<p>可以看出在滑动<code>UIScrollView</code>时，定时器被暂停了。</p>
<p>所以如果需要定时器在 <code>UIScrollView</code> 拖动时也不影响的话，有两种解决方法</p>
<ol>
<li><p><strong>timer</strong>分别添加到 <code>UITrackingRunLoopMode</code> 和 <code>NSDefaultRunLoopMode</code>中</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[[NSRunLoop mainRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];</div><div class="line">[[NSRunLoop mainRunLoop] addTimer:timer forMode: UITrackingRunLoopMode];</div></pre></td></tr></table></figure>
</li>
<li><p>直接将<strong>timer</strong>添加到<code>NSRunLoopCommonModes</code> 中：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[NSRunLoop mainRunLoop] addTimer:timer forMode: NSRunLoopCommonModes];</div></pre></td></tr></table></figure>
</li>
</ol>
<p>但并不是都<strong>timer</strong>所有的需要在滑动<code>UIScrollView</code>时继续执行，比如使用<strong>NSTimer</strong>完成的帧动画，滑动<code>UIScrollView</code>时就可以停止帧动画，保证滑动的流程性。</p>
<p>若没有特殊要求的话，一般使用第二种方法创建完<strong>timer</strong>，会自动添加到<code>NSDefaultRunLoopMode</code>中去执行，也是平时最常用的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(action:) userInfo:nil repeats:YES];</div></pre></td></tr></table></figure>
<p>参数：</p>
<p><code>TimeInterval</code>：延时时间</p>
<p><code>target</code>:目标对象，一般就是<code>self</code>本身</p>
<p><code>selector</code>:执行方法</p>
<p><code>userInfo</code>:传入信息</p>
<p><code>repeats</code>:是否重复执行</p>
<p>以上创建的定时器，若<code>repeats</code>参数设为<code>NO</code>，执行一次后就会被释放掉;</p>
<p>若<code>repeats</code>参数设为<code>YES</code>重复执行时，必须手动关闭，否则定时器不会释放(停止）。</p>
<p>释放方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 停止定时器</div><div class="line">[timer invalidate];</div></pre></td></tr></table></figure>
<p>实际开发中，我们会将<code>NSTimer</code>对象设置为属性，这样方便释放。</p>
<p><strong>iOS10.0</strong> 推出了两个新的API，与上面的方法相比，<code>selector</code>换成Block回调以、减少传入的参数(那几个参数真是鸡肋)。不过开发中一般需要适配低版本，还是尽量使用上面的方法吧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ (NSTimer *)timerWithTimeInterval:(NSTimeInterval)interval repeats:(BOOL)repeats block:(void (^)(NSTimer *timer))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));</div><div class="line"></div><div class="line">+ (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)interval repeats:(BOOL)repeats block:(void (^)(NSTimer *timer))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));</div></pre></td></tr></table></figure>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li><p><strong>必须加入Runloop</strong></p>
<p>  上面不管使用哪种方法，实际最后都会加入RunLoop中执行，区别就在于是否手动加入而已。</p>
</li>
<li><p><strong>存在延迟</strong></p>
<p>  不管是一次性的还是周期性的timer的实际触发事件的时间，都会与所加入的RunLoop和RunLoop Mode有关，如果此RunLoop正在执行一个连续性的运算，timer就会被延时出发。重复性的timer遇到这种情况，如果延迟超过了一个周期，则会在延时结束后立刻执行，并按照之前指定的周期继续执行，这个延迟时间大概为50-100毫秒.</p>
<p>  所以NSTimer不是绝对准确的,而且中间耗时或阻塞错过下一个点,那么下一个点就pass过去了.</p>
</li>
<li><p><strong>UIScrollView滑动会暂停计时</strong></p>
<p>  添加到<code>NSDefaultRunLoopMode</code>的 <code>timer</code> 在 <code>UIScrollView</code>滑动时会暂停，若不想被<code>UIScrollView</code>滑动影响，需要将 <code>timer</code> 添加再到 <code>UITrackingRunLoopMode</code> 或 直接添加到<code>NSRunLoopCommonModes</code> 中</p>
</li>
</ul>
<h2 id="CADisplayLink"><a href="#CADisplayLink" class="headerlink" title="CADisplayLink"></a>CADisplayLink</h2><p>CADisplayLink官方介绍：</p>
<blockquote>
<p>A CADisplayLink object is a timer object that allows your application to synchronize its drawing to the refresh rate of the display</p>
</blockquote>
<p><strong>CADisplayLink</strong>对象是一个和屏幕刷新率同步的定时器对象。每当屏幕显示内容刷新结束的时候，runloop就会向CADisplayLink指定的<code>target</code>发送一次指定的<code>selector</code>消息， CADisplayLink类对应的 <code>selector</code> 就会被调用一次。</p>
<p>从原理上可以看出，CADisplayLink适合做界面的不停重绘，比如视频播放的时候需要不停地获取下一帧用于界面渲染，或者做动画。</p>
<h4 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h4><p>创建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic, strong) CADisplayLink *displayLink;</div><div class="line"></div><div class="line">self.displayLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(handleDisplayLink:)];  </div><div class="line"></div><div class="line">// 每隔1帧调用一次</div><div class="line">self.displayLink.frameInterval = 1;  </div><div class="line"></div><div class="line">[self.displayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSDefaultRunLoopMode];</div></pre></td></tr></table></figure>
<p>释放方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[self.displayLink invalidate];  </div><div class="line"></div><div class="line">self.displayLink = nil;</div><div class="line">```      </div><div class="line">当把**CADisplayLink**对象添加到runloop中后，`selector`就能被周期性调用，类似于重复的NSTimer被启动了；执行`invalidate`操作时，CADisplayLink对象就会从runloop中移除，`selector`调用也随即停止，类似于NSTimer的`invalidate`方法。</div><div class="line"></div><div class="line">**CADisplayLink**中有两个重要的属性：</div><div class="line"></div><div class="line">- **frameInterval**</div><div class="line"></div><div class="line">	NSInteger类型的值，用来设置间隔多少帧调用一次`selector`方法，默认值是1，即每帧都调用一次。</div><div class="line">    </div><div class="line">- **duration**</div><div class="line"></div><div class="line">	`CFTimeInterval`值为`readOnly`，表示两次屏幕刷新之间的时间间隔。需要注意的是，该属性在`targe`t的`selector`被首次调用以后才会被赋值。`selector`的调用间隔时间计算方式是：**调用间隔时间 = duration × frameInterval**。</div><div class="line"> </div><div class="line"></div><div class="line">#### 特点</div><div class="line"></div><div class="line">- **刷新频率固定**</div><div class="line">	</div><div class="line">	正常情况iOS设备的屏幕刷新频率是固定**60Hz**,如果CPU过于繁忙，无法保证屏幕60次/秒的刷新率，就会导致跳过若干次调用回调方法的机会，跳过次数取决CPU的忙碌程度。</div><div class="line">- **屏幕刷新时调用**</div><div class="line"></div><div class="line">	CADisplayLink在正常情况下会在每次刷新结束都被调用，精确度相当高。但如果调用的方法比较耗时，超过了屏幕刷新周期，就会导致跳过若干次回调调用机会	</div><div class="line"></div><div class="line">- **适合做界面渲染**</div><div class="line"></div><div class="line">	CADisplayLink可以确保系统渲染每一帧的时候我们的方法都被调用，从而保证了动画的流畅性。</div><div class="line"></div><div class="line">GCD定时器</div><div class="line">---</div><div class="line">**GCD定时器**和NSTimer是不一样的，NSTimer受RunLoop影响，但是GCD的定时器不受影响，因为通过源码可知RunLoop也是基于GCD的实现的，所以GCD定时器有非常高的精度。关于GCD的使用可一看看[这篇博客](http://www.cnblogs.com/pure/archive/2013/03/31/2977420.html)。</div><div class="line"></div><div class="line">#### 使用方法</div><div class="line">创建GCD定时器定时器的方法稍微比较复杂，看下面的代码：</div></pre></td></tr></table></figure>
<p>// 定时时间<br>int interval = 1;</p>
<p>// 创建全局队列<br>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</p>
<p>// 创建定时器<br>dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);</p>
<p>// 设置定时器 interval <em> NSEC_PER_SEC  定时间隔几秒<br>dispatch_source_set_timer(timer, dispatch_walltime(NULL, 0), interval </em> NSEC_PER_SEC, 0);</p>
<p>dispatch_source_set_event_handler(timer, ^{</p>
<pre><code>dispatch_async(dispatch_get_main_queue(), ^{

    // 需要执行的代码
});
</code></pre><p>});</p>
<p>// 开启定时器<br>dispatch_resume(timer);</p>
<p>// 关闭定时器<br>dispatch_source_cancel(timer);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 单次的延时调用</div><div class="line">NSObject中的`performSelector:withObject:afterDelay:`以及 `performSelector:withObject:afterDelay:inModes:` 这两个方法在调用的时候会设置当前 runloop 中 `timer` ，前者设置的 `timer` 在 `NSDefaultRunLoopMode` 运行，后者则可以指定 **NSRunLoop** 的 `mode` 来执行。我们上面介绍过 runloop 中 `timer` 在 `UITrackingRunLoopMode` 被挂起，就导致了代码就会一直等待 `timer` 的调度,解决办法在上面也有说明。</div><div class="line"></div><div class="line">不过我们可以用另一套方案来解决这个问题，就是使用GCD中的 `dispatch_after` 来实现单次的延时调用：</div></pre></td></tr></table></figure></p>
<p>double delayInSeconds = 2.0;<br>    dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds * NSEC_PER_SEC));<br>    dispatch_after(popTime, dispatch_get_main_queue(), ^(void){<br>        [self someMethod];<br>    });<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 循环调用</div></pre></td></tr></table></figure></p>
<p>// 创建GCD定时器<br>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</p>
<p>dispatch_source_t _timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);</p>
<p>dispatch_source_set_timer(_timer, dispatch_walltime(NULL, 0), 1.0 * NSEC_PER_SEC, 0); //每秒执行</p>
<p>// 事件回调<br>dispatch_source_set_event_handler(_timer, ^{</p>
<pre><code>dispatch_async(dispatch_get_main_queue(), ^{
    // 在主线程中实现需要的功能

}
</code></pre><p>}</p>
<p>});</p>
<p>// 开启定时器<br>dispatch_resume(_timer);</p>
<p>// 挂起定时器（dispatch_suspend 之后的 Timer，是不能被释放的！会引起崩溃）<br>dispatch_suspend(_timer);</p>
<p>// 关闭定时器<br>dispatch_source_cancel(_timer);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">上面代码中要注意的是：</div><div class="line"></div><div class="line">1. `dispatch_source_set_event_handler()`中的任务实在子线程中执行的，若需要回到主线程，要调用`dispatch_async(dispatch_get_main_queue(), ^&#123;&#125;`.</div><div class="line">- `dispatch_source_set_timer` 中第二个参数，当我们使用 `dispatch_time` 或者 `DISPATCH_TIME_NOW` 时，系统会使用默认时钟来进行计时。然而当系统休眠的时候，默认时钟是不走的，也就会导致计时器停止。使用 `dispatch_walltime ` 可以让计时器按照真实时间间隔进行计时.</div><div class="line">- 第三个参数， ` 1.0 * NSEC_PER_SEC` 为每秒执行一次，对应的还有毫秒，分秒，纳秒可以选择.</div><div class="line"></div><div class="line"></div><div class="line">- `dispatch_source_set_event_handler` 这个函数在执行完之后，block 会立马执行一遍，后面隔一定时间间隔再执行一次。而 `NSTimer` 第一次执行是到计时器触发之后。这也是和 `NSTimer` 之间的一个显著区别。</div><div class="line">- 挂起（暂停）定时器, `dispatch_suspend` 之后的 `Timer`，不能被释放的,会引起崩溃.</div><div class="line">- 创建的`timer`一定要有`dispatch_suspend(_timer)`或`dispatch_source_cancel(_timer)`这两句话来指定出口，否则定时器将不执行，若我们想无限循环可将 `dispatch_source_cancel(_timer)` 写在一句永不执行的`if`判断语句中。</div><div class="line"></div><div class="line"></div><div class="line">使用场景</div><div class="line">---</div><div class="line">介绍完iOS中的各种定时器，接下来我们来说说这几种定时器在开发中的几种用法。</div><div class="line">###短信重发倒计时</div><div class="line"></div><div class="line">短信倒计时使我们登录注册常用的功能，一般设置为60s，实现方法如下：</div></pre></td></tr></table></figure>
<p>// 计时时间<br>@property (nonatomic, assign) int timeout;</p>
<p>/<em>* 开启倒计时 </em>/</p>
<ul>
<li><p>(void)startCountdown {</p>
<p>  if (_timeout &gt; 0) {</p>
<pre><code>return;
</code></pre><p>  }</p>
<p>  _timeout = 60;</p>
<p>  // GCD定时器<br>  dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</p>
<p>  dispatch_source_t _timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);</p>
<p>  dispatch_source_set_timer(_timer, dispatch_walltime(NULL, 0), 1.0 * NSEC_PER_SEC, 0); //每秒执行</p>
<p>  dispatch_source_set_event_handler(_timer, ^{</p>
<pre><code>if(_timeout &lt;= 0 ){// 倒计时结束

    // 关闭定时器
    dispatch_source_cancel(_timer);

    dispatch_async(dispatch_get_main_queue(), ^{

        //设置界面的按钮显示 根据自己需求设置
        [self.sendMsgBtn setTitle:@&quot;发送&quot; forState:UIControlStateNormal];

        self.sendMsgBtn.enabled = YES;

    });

}else{// 倒计时中

    // 显示倒计时结果

    NSString *strTime = [NSString stringWithFormat:@&quot;重发(%.2d)&quot;, _timeout];

    dispatch_async(dispatch_get_main_queue(), ^{

        //设置界面的按钮显示 根据自己需求设置

        [self.sendMsgBtn setTitle:[NSString stringWithFormat:@&quot;%@&quot;,strTime] forState:UIControlStateNormal];

        self.sendMsgBtn.enabled = NO;

    });

    _timeout--;
}
</code></pre><p>  });</p>
<p>  // 开启定时器<br>  dispatch_resume(_timer);</p>
</li>
</ul>
<p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在上面代码中，我们设置了一个60s循环倒计时，当我们向服务器获取短信验证码成功时 调用该方法开始倒计时。每秒刷新按钮的倒计时数，倒计时结束时再将按钮 `Title` 恢复为“发送”.</div><div class="line"></div><div class="line">有一点需要注意的是，按钮的样式要设置为 **UIButtonTypeCustom**,否则会出现刷新 `Title` 时闪烁.</div><div class="line"></div><div class="line">我们可以把这个方法封装一下，方便调用，否则在控制器中写这么一大段代码确实也不优雅。</div><div class="line"></div><div class="line">效果如下：</div><div class="line"></div><div class="line">![](http://ww3.sinaimg.cn/large/006tNc79jw1faspxkoemhj30ci0m8mxy.jpg)</div><div class="line"></div><div class="line">[代码的gitHub链接](https://github.com/qiubaiying/BYTimer)</div><div class="line"></div><div class="line"></div><div class="line">### 每个几分钟向服务器发送数据</div><div class="line"></div><div class="line">在有定位服务的APP中，我们需要每个一段时间将定位数据发送到服务器，比如每5s定位一次每隔5分钟将再统一将数据发送服务器，这样会处理比较省电。</div><div class="line">一般程序进入后台时，定时器会停止，但是在定位APP中，需要持续进行定位，APP在后台时依旧可以运行，所以在后台定时器也是可以运行的。</div><div class="line"></div><div class="line">注：关于iOS后台常驻,可以查看[这篇博客](http://waitingyuan.blog.163.com/blog/static/2155781652014111133150534/)</div><div class="line"></div><div class="line">在使用GCD定时的时候发现GCD定时器也可以在后代运行，创建方法同上面的短信倒计时.</div><div class="line"></div><div class="line">这里我们使用**NSTimer**来创建一个每个5分钟执行一次的定时器.</div></pre></td></tr></table></figure></p>
<p>#import <foundation foundation.h=""></foundation></p>
<p>typedef void(^TimerBlock)();</p>
<p>@interface BYTimer : NSObject</p>
<ul>
<li><p>(void)startTimerWithBlock:(TimerBlock)timerBlock;</p>
</li>
<li><p>(void)stopTimer;</p>
</li>
</ul>
<p>@end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>#import “BYTimer.h”</p>
<p>@interface BYTimer ()</p>
<p>@property (nonatomic, strong) NSTimer *timer;<br>@property (nonatomic, strong) TimerBlock timerBlock;</p>
<p>@end</p>
<p>@implementation BYTimer</p>
<ul>
<li><p>(void)startTimerWithBlock:(TimerBlock)timerBlock {</p>
<p>   self.timer = [NSTimer timerWithTimeInterval:300 target:self selector:@selector(_timerAction) userInfo:nil repeats:YES];</p>
<p>  [[NSRunLoop mainRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];<br>  _timerBlock = timerBlock;</p>
</li>
</ul>
<p>}</p>
<ul>
<li><p>(void)_timerAction {<br>  if (self.timerBlock) {</p>
<pre><code>self.timerBlock();
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)stopTimer {<br>  [self.timer invalidate];<br>}</p>
</li>
</ul>
<p>@end</p>
<p>```</p>
<p>该接口的实现很简单，就是<strong>NSTimer</strong>创建了一个300s执行一次的定时器，但是要注意定时器需要加入<code>NSRunLoopCommonModes</code>中。</p>
<p>最后，要使定时器在后台能运行，app就需要在<a href="http://waitingyuan.blog.163.com/blog/static/2155781652014111133150534/" target="_blank" rel="external">后台常驻</a>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/2016-12-07-忽略-Xcode8-中的注释警告⚠️/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/07/2016-12-07-忽略-Xcode8-中的注释警告⚠️/" itemprop="url">忽略 Xcode 8 中的注释警告</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-07T00:00:00+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>从Xcode8.0开始，引入了文档注释警告，虽然是件好事，可是各种三方库爆出了一大堆警告：</p>
<p><img src="http://ww2.sinaimg.cn/large/7853084cgw1fai8d9fu90j20ko0kpk21.jpg" alt=""></p>
<h4 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h4><p><code>Bulid Settings</code> -&gt; <code>Documentation Comments</code> -&gt; <strong><code>NO</code></strong></p>
<p><img src="http://ww1.sinaimg.cn/large/7853084cgw1fai8e613e5j20kk03cdga.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/01/2016-12-01-快速添加圆角和描边/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JimmyZhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jimmy'Zone">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/01/2016-12-01-快速添加圆角和描边/" itemprop="url">快速添加圆角和描边</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-01T00:00:00+08:00">
                2016-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>对于习惯使用Storyboard的人来说，设置圆角、描边是一件比较蛋疼的事，因为苹果没有在xcode的Interface Builder上直接提供修改控件的圆角，边框设置。</p>
<p>我们来说说如何对某个控件进行圆角、描边处理：</p>
<h1 id="初级"><a href="#初级" class="headerlink" title="初级"></a>初级</h1><p>对于一个初学者来说，如果要进行某个控件的圆角、描边设置，就要从Storyboard关联出属性，然后再对属性进行代码处理。</p>
<p>如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">self.myButton.layer.cornerRadius = 20;</div><div class="line">self.myButton.layer.masksToBounds = YES;</div><div class="line">self.myButton.layer.borderWidth = 2;</div><div class="line">self.myButton.layer.borderColor = [UIColor blackColor].CGColor;</div></pre></td></tr></table></figure>
<p>这样不仅需要Storyboard关联出属性，还要写一堆代码对属性进行设置，不得不说实在麻烦~</p>
<h1 id="中级"><a href="#中级" class="headerlink" title="中级"></a>中级</h1><p>更聪明的做法是使用Storyboard提供的Runtime Attributes为控件添加圆角描边。</p>
<p>选中控件，然后在Runtime Attributes框中输入对应的<code>Key</code>与<code>Type</code>与<code>Value</code>,这样程序在运行时就会通过KVC为你的控件属性进行赋值。(不仅仅是圆角、描边~)</p>
<p>如下图</p>
<p><img src="http://ww4.sinaimg.cn/large/7853084cgw1fabg89aeqkj207b08j74y.jpg" alt=""></p>
<p>设置圆角、描边的Key为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">layer.borderWidth</div><div class="line">layer.borderColorFromUIColor</div><div class="line">layer.cornerRadius</div><div class="line">clipsToBounds</div></pre></td></tr></table></figure>
<p>我这次在测试时，</p>
<p>这样做不用关联出属性，但是需要输入大串字符串，也是不够方便。</p>
<h1 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h1><p>创建UIView的分类，使用<code>IBInspectable</code>+ <code>IB_DESIGNABLE</code>关键字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">IB_DESIGNABLE</div><div class="line"></div><div class="line">@interface UIView (Inspectable)</div><div class="line"></div><div class="line">@property(nonatomic,assign) IBInspectable CGFloat cornerRadius;</div><div class="line">@property(nonatomic,assign) IBInspectable CGFloat borderWidth;</div><div class="line">@property(nonatomic,assign) IBInspectable UIColor *borderColor;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIView+Inspectable.h&quot;</div><div class="line"></div><div class="line">@implementation UIView (Inspectable)</div><div class="line"></div><div class="line">-(void)setCornerRadius:(CGFloat)cornerRadius&#123;</div><div class="line">    self.layer.masksToBounds = YES;</div><div class="line">    self.layer.cornerRadius = cornerRadius;</div><div class="line">&#125;</div><div class="line">-(void)setBorderColor:(UIColor *)borderColor&#123;</div><div class="line">    self.layer.borderColor = borderColor.CGColor;</div><div class="line">&#125;</div><div class="line">-(void)setBorderWidth:(CGFloat)borderWidth&#123;</div><div class="line">    self.layer.borderWidth = borderWidth;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGFloat)cornerRadius&#123;</div><div class="line">    return self.layer.cornerRadius;</div><div class="line">&#125;</div><div class="line">- (CGFloat)borderWidth&#123;</div><div class="line">    return self.layer.borderWidth;</div><div class="line">&#125;</div><div class="line">- (UIColor *)borderColor&#123;</div><div class="line">    return [UIColor colorWithCGColor:self.layer.borderColor];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>附上：<a href="https://github.com/qiubaiying/CircularAndStroke.git" target="_blank" rel="external">GitHub地址</a></p>
<h4 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h4><p>直接将这两个文件拖入项目中即可使用，在右边栏将会显示圆角和描边的属性设置</p>
<p>如图：</p>
<p><img src="http://ww4.sinaimg.cn/large/7853084cgw1facfqugjtbj20mp07v401.jpg" alt=""></p>
<h4 id="动态显示设置效果"><a href="#动态显示设置效果" class="headerlink" title="动态显示设置效果"></a>动态显示设置效果</h4><p>直接使用的话只有在运行时才能看到效果，</p>
<p>例如要实时显示一个<code>UIBUtton</code>圆角、描边效果，需要创建一个类继承<code>UIButton</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">#import &quot;UIView+Inspectable.h&quot;</div><div class="line"></div><div class="line">@interface myButton : UIButton</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#import &quot;myButton.h&quot;</div><div class="line"></div><div class="line">@implementation myButton</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>只要将button的Class选择该空白类即可</p>
<p>关于<code>IBInspectable</code>与<code>IB_DESIGNABLE</code>的使用详情可以参考这篇文章<a href="http://www.jianshu.com/p/a90e44ba1f2b" target="_blank" rel="external">《谈不完美的IBDesignable/IBInspectable可视化效果编程》</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.png"
              alt="JimmyZhao" />
          
            <p class="site-author-name" itemprop="name">JimmyZhao</p>
            <p class="site-description motion-element" itemprop="description">Jimmy | iOS | develop | 移动</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JimmyZDD" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/yourname" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>Twitter</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JimmyZhao</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
